!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,(function(key){return value[key]}).bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="zJiQ")}({wTN2:function(module,exports,__webpack_require__){var left,right,mix,deinterleaveChannel,DSP={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};function setupTypedArray(name,fallback){"function"!=typeof this[name]&&"object"!=typeof this[name]&&(this[name]="function"==typeof this[fallback]&&"object"!=typeof this[fallback]?this[fallback]:function(obj){return obj instanceof Array?obj:"number"==typeof obj?new Array(obj):void 0})}function FourierTransform(bufferSize,sampleRate){this.bufferSize=bufferSize,this.sampleRate=sampleRate,this.bandwidth=2/bufferSize*sampleRate/2,this.spectrum=new Float32Array(bufferSize/2),this.real=new Float32Array(bufferSize),this.imag=new Float32Array(bufferSize),this.peakBand=0,this.peak=0,this.getBandFrequency=function(index){return this.bandwidth*index+this.bandwidth/2},this.calculateSpectrum=function(){for(var rval,ival,mag,spectrum=this.spectrum,real=this.real,imag=this.imag,bSi=2/this.bufferSize,sqrt=Math.sqrt,i=0,N=bufferSize/2;i<N;i++)(mag=bSi*sqrt((rval=real[i])*rval+(ival=imag[i])*ival))>this.peak&&(this.peakBand=i,this.peak=mag),spectrum[i]=mag;return spectrum}}function DFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate);var N=bufferSize/2*bufferSize,TWO_PI=2*Math.PI;this.sinTable=new Float32Array(N),this.cosTable=new Float32Array(N);for(var i=0;i<N;i++)this.sinTable[i]=Math.sin(i*TWO_PI/bufferSize),this.cosTable[i]=Math.cos(i*TWO_PI/bufferSize)}function FFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate),this.reverseTable=new Uint32Array(bufferSize);for(var i,limit=1,bit=bufferSize>>1;limit<bufferSize;){for(i=0;i<limit;i++)this.reverseTable[i+limit]=this.reverseTable[i]+bit;limit<<=1,bit>>=1}for(this.sinTable=new Float32Array(bufferSize),this.cosTable=new Float32Array(bufferSize),i=0;i<bufferSize;i++)this.sinTable[i]=Math.sin(-Math.PI/i),this.cosTable[i]=Math.cos(-Math.PI/i)}function RFFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate),this.trans=new Float32Array(bufferSize),this.reverseTable=new Uint32Array(bufferSize),this.reverseBinPermute=function(dest,source,startAt){var h,bufferSize=this.bufferSize,halfSize=bufferSize>>>1,nm1=bufferSize-1,i=1,r=0;dest[0]=source[startAt=void 0!==startAt?startAt:0];do{for(dest[i]=source[startAt+(r+=halfSize)],dest[r]=source[startAt+i],i++,h=halfSize<<1;!((r^=h>>=1)&h););r>=i&&(dest[i]=source[startAt+r],dest[r]=source[startAt+i],dest[nm1-i]=source[startAt+nm1-r],dest[nm1-r]=source[startAt+nm1-i]),i++}while(i<halfSize);dest[nm1]=source[startAt+nm1]},this.generateReverseTable=function(){var h,bufferSize=this.bufferSize,halfSize=bufferSize>>>1,nm1=bufferSize-1,i=1,r=0;this.reverseTable[0]=0;do{for(this.reverseTable[i]=r+=halfSize,this.reverseTable[r]=i,i++,h=halfSize<<1;!((r^=h>>=1)&h););r>=i&&(this.reverseTable[i]=r,this.reverseTable[r]=i,this.reverseTable[nm1-i]=nm1-r,this.reverseTable[nm1-r]=nm1-i),i++}while(i<halfSize);this.reverseTable[nm1]=nm1},this.generateReverseTable()}function Sampler(file,bufferSize,sampleRate,playStart,playEnd,loopStart,loopEnd,loopMode){this.file=file,this.bufferSize=bufferSize,this.sampleRate=sampleRate,this.playStart=playStart||0,this.playEnd=playEnd||1,this.loopStart=loopStart||0,this.loopEnd=loopEnd||1,this.loopMode=loopMode||DSP.OFF,this.loaded=!1,this.samples=[],this.signal=new Float32Array(bufferSize),this.frameCount=0,this.envelope=null,this.amplitude=1,this.rootFrequency=110,this.frequency=550,this.step=this.frequency/this.rootFrequency,this.duration=0,this.samplesProcessed=0,this.playhead=0;var audio=document.createElement("AUDIO"),self=this;this.loadSamples=function(event){for(var buffer=DSP.getChannel(DSP.MIX,event.frameBuffer),i=0;i<buffer.length;i++)self.samples.push(buffer[i])},this.loadComplete=function(){self.samples=new Float32Array(self.samples),self.loaded=!0},this.loadMetaData=function(){self.duration=audio.duration},audio.addEventListener("MozAudioAvailable",this.loadSamples,!1),audio.addEventListener("loadedmetadata",this.loadMetaData,!1),audio.addEventListener("ended",this.loadComplete,!1),audio.muted=!0,audio.src=file,audio.play()}function Oscillator(type,frequency,amplitude,bufferSize,sampleRate){switch(this.frequency=frequency,this.amplitude=amplitude,this.bufferSize=bufferSize,this.sampleRate=sampleRate,this.frameCount=0,this.waveTableLength=2048,this.cyclesPerSample=frequency/sampleRate,this.signal=new Float32Array(bufferSize),this.envelope=null,parseInt(type,10)){case DSP.TRIANGLE:this.func=Oscillator.Triangle;break;case DSP.SAW:this.func=Oscillator.Saw;break;case DSP.SQUARE:this.func=Oscillator.Square;break;default:case DSP.SINE:this.func=Oscillator.Sine}this.generateWaveTable=function(){Oscillator.waveTable[this.func]=new Float32Array(2048);for(var waveTableHz=1/(this.waveTableLength/this.sampleRate),i=0;i<this.waveTableLength;i++)Oscillator.waveTable[this.func][i]=this.func(i*waveTableHz/this.sampleRate)},void 0===Oscillator.waveTable&&(Oscillator.waveTable={}),void 0===Oscillator.waveTable[this.func]&&this.generateWaveTable(),this.waveTable=Oscillator.waveTable[this.func]}function ADSR(attackLength,decayLength,sustainLevel,sustainLength,releaseLength,sampleRate){this.sampleRate=sampleRate,this.attackLength=attackLength,this.decayLength=decayLength,this.sustainLevel=sustainLevel,this.sustainLength=sustainLength,this.releaseLength=releaseLength,this.sampleRate=sampleRate,this.attackSamples=attackLength*sampleRate,this.decaySamples=decayLength*sampleRate,this.sustainSamples=sustainLength*sampleRate,this.releaseSamples=releaseLength*sampleRate,this.update=function(){this.attack=this.attackSamples,this.decay=this.attack+this.decaySamples,this.sustain=this.decay+this.sustainSamples,this.release=this.sustain+this.releaseSamples},this.update(),this.samplesProcessed=0}function IIRFilter(type,cutoff,resonance,sampleRate){switch(this.sampleRate=sampleRate,type){case DSP.LOWPASS:case DSP.LP12:this.func=new IIRFilter.LP12(cutoff,resonance,sampleRate)}}function IIRFilter2(type,cutoff,resonance,sampleRate){this.type=type,this.cutoff=cutoff,this.resonance=resonance,this.sampleRate=sampleRate,this.f=Float32Array(4),this.f[0]=0,this.f[1]=0,this.f[2]=0,this.f[3]=0,this.calcCoeff=function(cutoff,resonance){this.freq=2*Math.sin(Math.PI*Math.min(.25,cutoff/(2*this.sampleRate))),this.damp=Math.min(2*(1-Math.pow(resonance,.25)),Math.min(2,2/this.freq-.5*this.freq))},this.calcCoeff(cutoff,resonance)}function WindowFunction(type,alpha){switch(this.alpha=alpha,type){case DSP.BARTLETT:this.func=WindowFunction.Bartlett;break;case DSP.BARTLETTHANN:this.func=WindowFunction.BartlettHann;break;case DSP.BLACKMAN:this.func=WindowFunction.Blackman,this.alpha=this.alpha||.16;break;case DSP.COSINE:this.func=WindowFunction.Cosine;break;case DSP.GAUSS:this.func=WindowFunction.Gauss,this.alpha=this.alpha||.25;break;case DSP.HAMMING:this.func=WindowFunction.Hamming;break;case DSP.HANN:this.func=WindowFunction.Hann;break;case DSP.LANCZOS:this.func=WindowFunction.Lanczoz;break;case DSP.RECTANGULAR:this.func=WindowFunction.Rectangular;break;case DSP.TRIANGULAR:this.func=WindowFunction.Triangular}}function sinh(arg){return(Math.exp(arg)-Math.exp(-arg))/2}function Biquad(type,sampleRate){this.Fs=sampleRate,this.type=type,this.parameterType=DSP.Q,this.x_1_l=0,this.x_2_l=0,this.y_1_l=0,this.y_2_l=0,this.x_1_r=0,this.x_2_r=0,this.y_1_r=0,this.y_2_r=0,this.b0=1,this.a0=1,this.b1=0,this.a1=0,this.b2=0,this.a2=0,this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0,this.f0=3e3,this.dBgain=12,this.Q=1,this.BW=-3,this.S=1,this.coefficients=function(){return{b:[this.b0,this.b1,this.b2],a:[this.a0,this.a1,this.a2]}},this.setFilterType=function(type){this.type=type,this.recalculateCoefficients()},this.setSampleRate=function(rate){this.Fs=rate,this.recalculateCoefficients()},this.setQ=function(q){this.parameterType=DSP.Q,this.Q=Math.max(Math.min(q,115),.001),this.recalculateCoefficients()},this.setBW=function(bw){this.parameterType=DSP.BW,this.BW=bw,this.recalculateCoefficients()},this.setS=function(s){this.parameterType=DSP.S,this.S=Math.max(Math.min(s,5),1e-4),this.recalculateCoefficients()},this.setF0=function(freq){this.f0=freq,this.recalculateCoefficients()},this.setDbGain=function(g){this.dBgain=g,this.recalculateCoefficients()},this.recalculateCoefficients=function(){var A;A=type===DSP.PEAKING_EQ||type===DSP.LOW_SHELF||type===DSP.HIGH_SHELF?Math.pow(10,this.dBgain/40):Math.sqrt(Math.pow(10,this.dBgain/20));var coeff,w0=DSP.TWO_PI*this.f0/this.Fs,cosw0=Math.cos(w0),sinw0=Math.sin(w0),alpha=0;switch(this.parameterType){case DSP.Q:alpha=sinw0/(2*this.Q);break;case DSP.BW:alpha=sinw0*sinh(Math.LN2/2*this.BW*w0/sinw0);break;case DSP.S:alpha=sinw0/2*Math.sqrt((A+1/A)*(1/this.S-1)+2)}switch(this.type){case DSP.LPF:this.b0=(1-cosw0)/2,this.b1=1-cosw0,this.b2=(1-cosw0)/2,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.HPF:this.b0=(1+cosw0)/2,this.b1=-(1+cosw0),this.b2=(1+cosw0)/2,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.BPF_CONSTANT_SKIRT:this.b0=sinw0/2,this.b1=0,this.b2=-sinw0/2,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.BPF_CONSTANT_PEAK:this.b0=alpha,this.b1=0,this.b2=-alpha,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.NOTCH:this.b0=1,this.b1=-2*cosw0,this.b2=1,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.APF:this.b0=1-alpha,this.b1=-2*cosw0,this.b2=1+alpha,this.a0=1+alpha,this.a1=-2*cosw0,this.a2=1-alpha;break;case DSP.PEAKING_EQ:this.b0=1+alpha*A,this.b1=-2*cosw0,this.b2=1-alpha*A,this.a0=1+alpha/A,this.a1=-2*cosw0,this.a2=1-alpha/A;break;case DSP.LOW_SHELF:coeff=sinw0*Math.sqrt((3^A)*(1/this.S-1)+2*A),this.b0=A*(A+1-(A-1)*cosw0+coeff),this.b1=2*A*(A-1-(A+1)*cosw0),this.b2=A*(A+1-(A-1)*cosw0-coeff),this.a0=A+1+(A-1)*cosw0+coeff,this.a1=-2*(A-1+(A+1)*cosw0),this.a2=A+1+(A-1)*cosw0-coeff;break;case DSP.HIGH_SHELF:coeff=sinw0*Math.sqrt((3^A)*(1/this.S-1)+2*A),this.b0=A*(A+1+(A-1)*cosw0+coeff),this.b1=-2*A*(A-1+(A+1)*cosw0),this.b2=A*(A+1+(A-1)*cosw0-coeff),this.a0=A+1-(A-1)*cosw0+coeff,this.a1=2*(A-1-(A+1)*cosw0),this.a2=A+1-(A-1)*cosw0-coeff}this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0},this.process=function(buffer){for(var output=new Float32Array(buffer.length),i=0;i<buffer.length;i++)output[i]=this.b0a0*buffer[i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=output[i],this.x_2_l=this.x_1_l,this.x_1_l=buffer[i];return output},this.processStereo=function(buffer){for(var len=buffer.length,output=new Float32Array(len),i=0;i<len/2;i++)output[2*i]=this.b0a0*buffer[2*i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=output[2*i],this.x_2_l=this.x_1_l,this.x_1_l=buffer[2*i],output[2*i+1]=this.b0a0*buffer[2*i+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r,this.y_2_r=this.y_1_r,this.y_1_r=output[2*i+1],this.x_2_r=this.x_1_r,this.x_1_r=buffer[2*i+1];return output}}function MultiDelay(maxDelayInSamplesSize,delayInSamples,masterVolume,delayVolume){this.delayBufferSamples=new Float32Array(maxDelayInSamplesSize),this.delayInputPointer=delayInSamples,this.delayOutputPointer=0,this.delayInSamples=delayInSamples,this.masterVolume=masterVolume,this.delayVolume=delayVolume}function SingleDelay(maxDelayInSamplesSize,delayInSamples,delayVolume){this.delayBufferSamples=new Float32Array(maxDelayInSamplesSize),this.delayInputPointer=delayInSamples,this.delayOutputPointer=0,this.delayInSamples=delayInSamples,this.delayVolume=delayVolume}function Reverb(maxDelayInSamplesSize,delayInSamples,masterVolume,mixVolume,delayVolume,dampFrequency){var i,delayMultiply;for(this.delayInSamples=delayInSamples,this.masterVolume=masterVolume,this.mixVolume=mixVolume,this.delayVolume=delayVolume,this.dampFrequency=dampFrequency,this.NR_OF_MULTIDELAYS=6,this.NR_OF_SINGLEDELAYS=6,this.LOWPASSL=new IIRFilter2(DSP.LOWPASS,dampFrequency,0,44100),this.LOWPASSR=new IIRFilter2(DSP.LOWPASS,dampFrequency,0,44100),this.singleDelays=[],i=0;i<this.NR_OF_SINGLEDELAYS;i++)delayMultiply=1+i/7,this.singleDelays[i]=new SingleDelay(maxDelayInSamplesSize,Math.round(this.delayInSamples*delayMultiply),this.delayVolume);for(this.multiDelays=[],i=0;i<this.NR_OF_MULTIDELAYS;i++)delayMultiply=1+i/10,this.multiDelays[i]=new MultiDelay(maxDelayInSamplesSize,Math.round(this.delayInSamples*delayMultiply),this.masterVolume,this.delayVolume)}setupTypedArray("Float32Array","WebGLFloatArray"),setupTypedArray("Int32Array","WebGLIntArray"),setupTypedArray("Uint16Array","WebGLUnsignedShortArray"),setupTypedArray("Uint8Array","WebGLUnsignedByteArray"),DSP.invert=function(buffer){for(var i=0,len=buffer.length;i<len;i++)buffer[i]*=-1;return buffer},DSP.interleave=function(left,right){if(left.length!==right.length)throw"Can not interleave. Channel lengths differ.";for(var stereoInterleaved=new Float32Array(2*left.length),i=0,len=left.length;i<len;i++)stereoInterleaved[2*i]=left[i],stereoInterleaved[2*i+1]=right[i];return stereoInterleaved},DSP.deinterleave=((deinterleaveChannel=[])[DSP.MIX]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++)mix[i]=(buffer[2*i]+buffer[2*i+1])/2;return mix},deinterleaveChannel[DSP.LEFT]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++)left[i]=buffer[2*i];return left},deinterleaveChannel[DSP.RIGHT]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++)right[i]=buffer[2*i+1];return right},function(channel,buffer){return left=left||new Float32Array(buffer.length/2),right=right||new Float32Array(buffer.length/2),mix=mix||new Float32Array(buffer.length/2),buffer.length/2!==left.length&&(left=new Float32Array(buffer.length/2),right=new Float32Array(buffer.length/2),mix=new Float32Array(buffer.length/2)),deinterleaveChannel[channel](buffer)}),DSP.getChannel=DSP.deinterleave,DSP.mixSampleBuffers=function(sampleBuffer1,sampleBuffer2,negate,volumeCorrection){for(var outputSamples=new Float32Array(sampleBuffer1),i=0;i<sampleBuffer1.length;i++)outputSamples[i]+=(negate?-sampleBuffer2[i]:sampleBuffer2[i])/volumeCorrection;return outputSamples},DSP.LPF=0,DSP.HPF=1,DSP.BPF_CONSTANT_SKIRT=2,DSP.BPF_CONSTANT_PEAK=3,DSP.NOTCH=4,DSP.APF=5,DSP.PEAKING_EQ=6,DSP.LOW_SHELF=7,DSP.HIGH_SHELF=8,DSP.Q=1,DSP.BW=2,DSP.S=3,DSP.RMS=function(buffer){for(var total=0,i=0,n=buffer.length;i<n;i++)total+=buffer[i]*buffer[i];return Math.sqrt(total/n)},DSP.Peak=function(buffer){for(var peak=0,i=0,n=buffer.length;i<n;i++)peak=Math.abs(buffer[i])>peak?Math.abs(buffer[i]):peak;return peak},DFT.prototype.forward=function(buffer){for(var rval,ival,real=this.real,imag=this.imag,k=0;k<this.bufferSize/2;k++){rval=0,ival=0;for(var n=0;n<buffer.length;n++)rval+=this.cosTable[k*n]*buffer[n],ival+=this.sinTable[k*n]*buffer[n];real[k]=rval,imag[k]=ival}return this.calculateSpectrum()},FFT.prototype.forward=function(buffer){var bufferSize=this.bufferSize,cosTable=this.cosTable,sinTable=this.sinTable,reverseTable=this.reverseTable,real=this.real,imag=this.imag,k=Math.floor(Math.log(bufferSize)/Math.LN2);if(Math.pow(2,k)!==bufferSize)throw"Invalid buffer size, must be a power of 2.";if(bufferSize!==buffer.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+bufferSize+" Buffer Size: "+buffer.length;var phaseShiftStepReal,phaseShiftStepImag,currentPhaseShiftReal,currentPhaseShiftImag,off,tr,ti,tmpReal,i,halfSize=1;for(i=0;i<bufferSize;i++)real[i]=buffer[reverseTable[i]],imag[i]=0;for(;halfSize<bufferSize;){phaseShiftStepReal=cosTable[halfSize],phaseShiftStepImag=sinTable[halfSize],currentPhaseShiftReal=1,currentPhaseShiftImag=0;for(var fftStep=0;fftStep<halfSize;fftStep++){for(i=fftStep;i<bufferSize;)ti=currentPhaseShiftReal*imag[off=i+halfSize]+currentPhaseShiftImag*real[off],real[off]=real[i]-(tr=currentPhaseShiftReal*real[off]-currentPhaseShiftImag*imag[off]),imag[off]=imag[i]-ti,real[i]+=tr,imag[i]+=ti,i+=halfSize<<1;currentPhaseShiftReal=(tmpReal=currentPhaseShiftReal)*phaseShiftStepReal-currentPhaseShiftImag*phaseShiftStepImag,currentPhaseShiftImag=tmpReal*phaseShiftStepImag+currentPhaseShiftImag*phaseShiftStepReal}halfSize<<=1}return this.calculateSpectrum()},FFT.prototype.inverse=function(real,imag){var bufferSize=this.bufferSize,cosTable=this.cosTable,sinTable=this.sinTable,reverseTable=this.reverseTable;real=real||this.real,imag=imag||this.imag;var phaseShiftStepReal,phaseShiftStepImag,currentPhaseShiftReal,currentPhaseShiftImag,off,tr,ti,tmpReal,i,halfSize=1;for(i=0;i<bufferSize;i++)imag[i]*=-1;var revReal=new Float32Array(bufferSize),revImag=new Float32Array(bufferSize);for(i=0;i<real.length;i++)revReal[i]=real[reverseTable[i]],revImag[i]=imag[reverseTable[i]];for(real=revReal,imag=revImag;halfSize<bufferSize;){phaseShiftStepReal=cosTable[halfSize],phaseShiftStepImag=sinTable[halfSize],currentPhaseShiftReal=1,currentPhaseShiftImag=0;for(var fftStep=0;fftStep<halfSize;fftStep++){for(i=fftStep;i<bufferSize;)ti=currentPhaseShiftReal*imag[off=i+halfSize]+currentPhaseShiftImag*real[off],real[off]=real[i]-(tr=currentPhaseShiftReal*real[off]-currentPhaseShiftImag*imag[off]),imag[off]=imag[i]-ti,real[i]+=tr,imag[i]+=ti,i+=halfSize<<1;currentPhaseShiftReal=(tmpReal=currentPhaseShiftReal)*phaseShiftStepReal-currentPhaseShiftImag*phaseShiftStepImag,currentPhaseShiftImag=tmpReal*phaseShiftStepImag+currentPhaseShiftImag*phaseShiftStepReal}halfSize<<=1}var buffer=new Float32Array(bufferSize);for(i=0;i<bufferSize;i++)buffer[i]=real[i]/bufferSize;return buffer},RFFT.prototype.forward=function(buffer,startAt){startAt=void 0!==startAt?startAt:0;var n2,n4,n8,nn,t1,t2,t3,t4,i1,i2,i3,i4,i5,i6,i7,i8,st1,cc1,ss1,cc3,ss3,e,a,rval,ival,mag,n=this.bufferSize,spectrum=this.spectrum,x=this.trans,TWO_PI=2*Math.PI,sqrt=Math.sqrt,i=n>>>1,bSi=2/n;this.reverseBinPermute(x,buffer,startAt);for(var ix=0,id=4;ix<n;id*=4){for(var i0=ix;i0<n;i0+=id)st1=x[i0]-x[i0+1],x[i0]+=x[i0+1],x[i0+1]=st1;ix=2*(id-1)}for(n2=2,nn=n>>>1;nn>>>=1;){ix=0,id=(n2<<=1)<<1,n4=n2>>>2,n8=n2>>>3;do{if(1!==n4)for(i0=ix;i0<n;i0+=id)t1=x[i3=(i2=(i1=i0)+n4)+n4]+x[i4=i3+n4],x[i4]-=x[i3],x[i3]=x[i1]-t1,x[i1]+=t1,i1+=n8,i2+=n8,t2=x[i3+=n8]-x[i4+=n8],t1=-(t1=x[i3]+x[i4])*Math.SQRT1_2,t2*=Math.SQRT1_2,x[i4]=t1+(st1=x[i2]),x[i3]=t1-st1,x[i2]=x[i1]-t2,x[i1]+=t2;else for(i0=ix;i0<n;i0+=id)t1=x[i3=(i2=(i1=i0)+n4)+n4]+x[i4=i3+n4],x[i4]-=x[i3],x[i3]=x[i1]-t1,x[i1]+=t1;ix=(id<<1)-n2,id<<=2}while(ix<n);e=TWO_PI/n2;for(var j=1;j<n8;j++){a=j*e,ss1=Math.sin(a),cc3=4*(cc1=Math.cos(a))*(cc1*cc1-.75),ss3=4*ss1*(.75-ss1*ss1),ix=0,id=n2<<1;do{for(i0=ix;i0<n;i0+=id)t1=x[i7=(i6=(i5=i0+n4-j)+n4)+n4]*ss1+x[i3=(i2=(i1=i0+j)+n4)+n4]*cc1,t3=x[i8=i7+n4]*ss3+x[i4=i3+n4]*cc3,st1=(t2=x[i7]*cc1-x[i3]*ss1)-(t4=x[i8]*cc3-x[i4]*ss3),t2+=t4,t4=st1,x[i8]=t2+x[i6],x[i3]=t2-x[i6],st1=t3-t1,t1+=t3,x[i4]=(t3=st1)+x[i2],x[i7]=t3-x[i2],x[i6]=x[i1]-t1,x[i1]+=t1,x[i2]=t4+x[i5],x[i5]-=t4;ix=(id<<1)-n2,id<<=2}while(ix<n)}}for(;--i;)(mag=bSi*sqrt((rval=x[i])*rval+(ival=x[n-i-1])*ival))>this.peak&&(this.peakBand=i,this.peak=mag),spectrum[i]=mag;return spectrum[0]=bSi*x[0],spectrum},Sampler.prototype.applyEnvelope=function(){return this.envelope.process(this.signal),this.signal},Sampler.prototype.generate=function(){for(var loopWidth=this.playEnd*this.samples.length-this.playStart*this.samples.length,playStartSamples=this.playStart*this.samples.length,playEndSamples=this.playEnd*this.samples.length,i=0;i<this.bufferSize;i++){switch(this.loopMode){case DSP.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+playStartSamples),this.signal[i]=this.playhead<this.playEnd*this.samples.length?this.samples[this.playhead]*this.amplitude:0;break;case DSP.FW:this.playhead=Math.round(this.samplesProcessed*this.step%loopWidth+playStartSamples),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude);break;case DSP.BW:this.playhead=playEndSamples-Math.round(this.samplesProcessed*this.step%loopWidth),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude);break;case DSP.FWBW:this.playhead=Math.floor(this.samplesProcessed*this.step/loopWidth)%2==0?Math.round(this.samplesProcessed*this.step%loopWidth+playStartSamples):playEndSamples-Math.round(this.samplesProcessed*this.step%loopWidth),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude)}this.samplesProcessed++}return this.frameCount++,this.signal},Sampler.prototype.setFreq=function(frequency){var totalProcessed=this.samplesProcessed*this.step;this.frequency=frequency,this.step=this.frequency/this.rootFrequency,this.samplesProcessed=Math.round(totalProcessed/this.step)},Sampler.prototype.reset=function(){this.samplesProcessed=0,this.playhead=0},Oscillator.prototype.setAmp=function(amplitude){if(!(amplitude>=0&&amplitude<=1))throw"Amplitude out of range (0..1).";this.amplitude=amplitude},Oscillator.prototype.setFreq=function(frequency){this.frequency=frequency,this.cyclesPerSample=frequency/this.sampleRate},Oscillator.prototype.add=function(oscillator){for(var i=0;i<this.bufferSize;i++)this.signal[i]+=oscillator.signal[i];return this.signal},Oscillator.prototype.addSignal=function(signal){for(var i=0;i<signal.length&&!(i>=this.bufferSize);i++)this.signal[i]+=signal[i];return this.signal},Oscillator.prototype.addEnvelope=function(envelope){this.envelope=envelope},Oscillator.prototype.applyEnvelope=function(){this.envelope.process(this.signal)},Oscillator.prototype.valueAt=function(offset){return this.waveTable[offset%this.waveTableLength]},Oscillator.prototype.generate=function(){for(var offset,frameOffset=this.frameCount*this.bufferSize,step=this.waveTableLength*this.frequency/this.sampleRate,i=0;i<this.bufferSize;i++)offset=Math.round((frameOffset+i)*step),this.signal[i]=this.waveTable[offset%this.waveTableLength]*this.amplitude;return this.frameCount++,this.signal},Oscillator.Sine=function(step){return Math.sin(DSP.TWO_PI*step)},Oscillator.Square=function(step){return step<.5?1:-1},Oscillator.Saw=function(step){return 2*(step-Math.round(step))},Oscillator.Triangle=function(step){return 1-4*Math.abs(Math.round(step)-step)},Oscillator.Pulse=function(step){},ADSR.prototype.noteOn=function(){this.samplesProcessed=0,this.sustainSamples=this.sustainLength*this.sampleRate,this.update()},ADSR.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples,this.update()},ADSR.prototype.processSample=function(sample){var amplitude=0;return this.samplesProcessed<=this.attack?amplitude=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?amplitude=1+(this.samplesProcessed-this.attack)/(this.decay-this.attack)*(this.sustainLevel-1):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?amplitude=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(amplitude=this.sustainLevel+(this.samplesProcessed-this.sustain)/(this.release-this.sustain)*(0-this.sustainLevel)),sample*amplitude},ADSR.prototype.value=function(){var amplitude=0;return this.samplesProcessed<=this.attack?amplitude=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?amplitude=1+(this.samplesProcessed-this.attack)/(this.decay-this.attack)*(this.sustainLevel-1):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?amplitude=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(amplitude=this.sustainLevel+(this.samplesProcessed-this.sustain)/(this.release-this.sustain)*(0-this.sustainLevel)),amplitude},ADSR.prototype.process=function(buffer){for(var i=0;i<buffer.length;i++)buffer[i]*=this.value(),this.samplesProcessed++;return buffer},ADSR.prototype.isActive=function(){return!(this.samplesProcessed>this.release||-1===this.samplesProcessed)},ADSR.prototype.disable=function(){this.samplesProcessed=-1},IIRFilter.prototype.__defineGetter__("cutoff",(function(){return this.func.cutoff})),IIRFilter.prototype.__defineGetter__("resonance",(function(){return this.func.resonance})),IIRFilter.prototype.set=function(cutoff,resonance){this.func.calcCoeff(cutoff,resonance)},IIRFilter.prototype.process=function(buffer){this.func.process(buffer)},IIRFilter.prototype.addEnvelope=function(envelope){if(!(envelope instanceof ADSR))throw"Not an envelope.";this.func.addEnvelope(envelope)},(IIRFilter.LP12=function(cutoff,resonance,sampleRate){this.sampleRate=sampleRate,this.vibraPos=0,this.vibraSpeed=0,this.envelope=!1,this.calcCoeff=function(cutoff,resonance){this.w=2*Math.PI*cutoff/this.sampleRate,this.q=1-this.w/(2*(resonance+.5/(1+this.w))+this.w-2),this.r=this.q*this.q,this.c=this.r+1-2*Math.cos(this.w)*this.q,this.cutoff=cutoff,this.resonance=resonance},this.calcCoeff(cutoff,resonance),this.process=function(buffer){for(var i=0;i<buffer.length;i++)this.vibraSpeed+=(buffer[i]-this.vibraPos)*this.c,this.vibraPos+=this.vibraSpeed,this.vibraSpeed*=this.r,this.envelope?(buffer[i]=buffer[i]*(1-this.envelope.value())+this.vibraPos*this.envelope.value(),this.envelope.samplesProcessed++):buffer[i]=this.vibraPos}}).prototype.addEnvelope=function(envelope){this.envelope=envelope},IIRFilter2.prototype.process=function(buffer){for(var input,output,f=this.f,i=0;i<buffer.length;i++)f[3]=(input=buffer[i])-this.damp*f[2],f[0]=f[0]+this.freq*f[2],f[1]=f[3]-f[0],f[2]=this.freq*f[1]+f[2],output=.5*f[this.type],f[3]=input-this.damp*f[2],f[0]=f[0]+this.freq*f[2],f[1]=f[3]-f[0],f[2]=this.freq*f[1]+f[2],output+=.5*f[this.type],this.envelope?(buffer[i]=buffer[i]*(1-this.envelope.value())+output*this.envelope.value(),this.envelope.samplesProcessed++):buffer[i]=output},IIRFilter2.prototype.addEnvelope=function(envelope){if(!(envelope instanceof ADSR))throw"This is not an envelope.";this.envelope=envelope},IIRFilter2.prototype.set=function(cutoff,resonance){this.calcCoeff(cutoff,resonance)},WindowFunction.prototype.process=function(buffer,startAt,length){length=void 0!==length?length:buffer.length;for(var i=startAt=void 0!==startAt?startAt:0;i<length;i++)buffer[i]*=this.func(length,i,this.alpha);return buffer},WindowFunction.Bartlett=function(length,index){return 2/(length-1)*((length-1)/2-Math.abs(index-(length-1)/2))},WindowFunction.BartlettHann=function(length,index){return.62-.48*Math.abs(index/(length-1)-.5)-.38*Math.cos(DSP.TWO_PI*index/(length-1))},WindowFunction.Blackman=function(length,index,alpha){var a2=alpha/2;return(1-alpha)/2-.5*Math.cos(DSP.TWO_PI*index/(length-1))+a2*Math.cos(4*Math.PI*index/(length-1))},WindowFunction.Cosine=function(length,index){return Math.cos(Math.PI*index/(length-1)-Math.PI/2)},WindowFunction.Gauss=function(length,index,alpha){return Math.pow(Math.E,-.5*Math.pow((index-(length-1)/2)/(alpha*(length-1)/2),2))},WindowFunction.Hamming=function(length,index){return.54-.46*Math.cos(DSP.TWO_PI*index/(length-1))},WindowFunction.Hann=function(length,index){return.5*(1-Math.cos(DSP.TWO_PI*index/(length-1)))},WindowFunction.Lanczos=function(length,index){var x=2*index/(length-1)-1;return Math.sin(Math.PI*x)/(Math.PI*x)},WindowFunction.Rectangular=function(length,index){return 1},WindowFunction.Triangular=function(length,index){return 2/length*(length/2-Math.abs(index-(length-1)/2))},DSP.mag2db=function(buffer){for(var minMag=Math.pow(10,-6),log=Math.log,max=Math.max,result=Float32Array(buffer.length),i=0;i<buffer.length;i++)result[i]=20*log(max(buffer[i],minMag));return result},DSP.freqz=function(b,a,w){var i,j;if(!w)for(w=Float32Array(200),i=0;i<w.length;i++)w[i]=DSP.TWO_PI/w.length*i-Math.PI;var result=Float32Array(w.length),sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin;for(i=0;i<w.length;i++){var numerator={real:0,imag:0};for(j=0;j<b.length;j++)numerator.real+=b[j]*cos(-j*w[i]),numerator.imag+=b[j]*sin(-j*w[i]);var denominator={real:0,imag:0};for(j=0;j<a.length;j++)denominator.real+=a[j]*cos(-j*w[i]),denominator.imag+=a[j]*sin(-j*w[i]);result[i]=sqrt(numerator.real*numerator.real+numerator.imag*numerator.imag)/sqrt(denominator.real*denominator.real+denominator.imag*denominator.imag)}return result},MultiDelay.prototype.setDelayInSamples=function(delayInSamples){this.delayInSamples=delayInSamples,this.delayInputPointer=this.delayOutputPointer+delayInSamples,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},MultiDelay.prototype.setMasterVolume=function(masterVolume){this.masterVolume=masterVolume},MultiDelay.prototype.setDelayVolume=function(delayVolume){this.delayVolume=delayVolume},MultiDelay.prototype.process=function(samples){for(var outputSamples=new Float32Array(samples.length),i=0;i<samples.length;i++){var sample=(null===this.delayBufferSamples[this.delayOutputPointer]?0:this.delayBufferSamples[this.delayOutputPointer])*this.delayVolume+samples[i];this.delayBufferSamples[this.delayInputPointer]=sample,outputSamples[i]=sample*this.masterVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return outputSamples},SingleDelay.prototype.setDelayInSamples=function(delayInSamples){this.delayInSamples=delayInSamples,this.delayInputPointer=this.delayOutputPointer+delayInSamples,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},SingleDelay.prototype.setDelayVolume=function(delayVolume){this.delayVolume=delayVolume},SingleDelay.prototype.process=function(samples){for(var outputSamples=new Float32Array(samples.length),i=0;i<samples.length;i++)this.delayBufferSamples[this.delayInputPointer]=samples[i],outputSamples[i]=this.delayBufferSamples[this.delayOutputPointer]*this.delayVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0);return outputSamples},Reverb.prototype.setDelayInSamples=function(delayInSamples){var i,delayMultiply;for(this.delayInSamples=delayInSamples,i=0;i<this.NR_OF_SINGLEDELAYS;i++)delayMultiply=1+i/7,this.singleDelays[i].setDelayInSamples(Math.round(this.delayInSamples*delayMultiply));for(i=0;i<this.NR_OF_MULTIDELAYS;i++)delayMultiply=1+i/10,this.multiDelays[i].setDelayInSamples(Math.round(this.delayInSamples*delayMultiply))},Reverb.prototype.setMasterVolume=function(masterVolume){this.masterVolume=masterVolume},Reverb.prototype.setMixVolume=function(mixVolume){this.mixVolume=mixVolume},Reverb.prototype.setDelayVolume=function(delayVolume){var i;for(this.delayVolume=delayVolume,i=0;i<this.NR_OF_SINGLEDELAYS;i++)this.singleDelays[i].setDelayVolume(this.delayVolume);for(i=0;i<this.NR_OF_MULTIDELAYS;i++)this.multiDelays[i].setDelayVolume(this.delayVolume)},Reverb.prototype.setDampFrequency=function(dampFrequency){this.dampFrequency=dampFrequency,this.LOWPASSL.set(dampFrequency,0),this.LOWPASSR.set(dampFrequency,0)},Reverb.prototype.process=function(interleavedSamples){var outputSamples=new Float32Array(interleavedSamples.length),leftRightMix=DSP.deinterleave(interleavedSamples);this.LOWPASSL.process(leftRightMix[DSP.LEFT]),this.LOWPASSR.process(leftRightMix[DSP.RIGHT]);var i,filteredSamples=DSP.interleave(leftRightMix[DSP.LEFT],leftRightMix[DSP.RIGHT]);for(i=0;i<this.NR_OF_MULTIDELAYS;i++)outputSamples=DSP.mixSampleBuffers(outputSamples,this.multiDelays[i].process(filteredSamples),2%i==0,this.NR_OF_MULTIDELAYS);var singleDelaySamples=new Float32Array(outputSamples.length);for(i=0;i<this.NR_OF_SINGLEDELAYS;i++)singleDelaySamples=DSP.mixSampleBuffers(singleDelaySamples,this.singleDelays[i].process(outputSamples),2%i==0,1);for(i=0;i<singleDelaySamples.length;i++)singleDelaySamples[i]*=this.mixVolume;for(outputSamples=DSP.mixSampleBuffers(singleDelaySamples,interleavedSamples,0,1),i=0;i<outputSamples.length;i++)outputSamples[i]*=this.masterVolume;return outputSamples},void 0!==module.exports&&(module.exports={DSP:DSP,DFT:DFT,FFT:FFT,RFFT:RFFT,Sampler:Sampler,Oscillator:Oscillator,ADSR:ADSR,IIRFilter:IIRFilter,IIRFilter2:IIRFilter2,WindowFunction:WindowFunction,sinh:sinh,Biquad:Biquad,GraphicalEq:function(sampleRate){this.FS=sampleRate,this.minFreq=40,this.maxFreq=16e3,this.bandsPerOctave=1,this.filters=[],this.freqzs=[],this.calculateFreqzs=!0,this.recalculateFilters=function(){var bandCount=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var i=0;i<bandCount;i++){var freq=this.minFreq*Math.pow(2,i/this.bandsPerOctave),newFilter=new Biquad(DSP.PEAKING_EQ,this.FS);newFilter.setDbGain(0),newFilter.setBW(1/this.bandsPerOctave),newFilter.setF0(freq),this.filters[i]=newFilter,this.recalculateFreqz(i)}},this.setMinimumFrequency=function(freq){this.minFreq=freq,this.recalculateFilters()},this.setMaximumFrequency=function(freq){this.maxFreq=freq,this.recalculateFilters()},this.setBandsPerOctave=function(bands){this.bandsPerOctave=bands,this.recalculateFilters()},this.setBandGain=function(bandIndex,gain){if(bandIndex<0||bandIndex>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds.";if(!gain)throw"A gain must be passed.";this.filters[bandIndex].setDbGain(gain),this.recalculateFreqz(bandIndex)},this.recalculateFreqz=function(bandIndex){if(this.calculateFreqzs){if(bandIndex<0||bandIndex>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds. "+bandIndex+" is out of [0, "+this.filters.length-1+"]";if(!this.w){this.w=Float32Array(400);for(var i=0;i<this.w.length;i++)this.w[i]=Math.PI/this.w.length*i}this.freqzs[bandIndex]=DSP.mag2db(DSP.freqz([this.filters[bandIndex].b0,this.filters[bandIndex].b1,this.filters[bandIndex].b2],[this.filters[bandIndex].a0,this.filters[bandIndex].a1,this.filters[bandIndex].a2],this.w))}},this.process=function(buffer){for(var output=buffer,i=0;i<this.filters.length;i++)output=this.filters[i].process(output);return output},this.processStereo=function(buffer){for(var output=buffer,i=0;i<this.filters.length;i++)output=this.filters[i].processStereo(output);return output}},MultiDelay:MultiDelay,SingleDelay:SingleDelay,Reverb:Reverb})},zJiQ:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),throwSet=new WeakSet,transferHandlers=new Map([["proxy",{canHandle:obj=>obj&&obj[proxyMarker],serialize(obj){const{port1:port1,port2:port2}=new MessageChannel;return expose(obj,port1),[port2,[port2]]},deserialize:port=>(port.start(),function(ep,target){return function createProxy(ep,path=[],target=function(){}){let isProxyReleased=!1;const proxy=new Proxy(target,{get(_target,prop){if(throwIfProxyReleased(isProxyReleased),prop===releaseProxy)return()=>requestResponseMessage(ep,{type:5,path:path.map(p=>p.toString())}).then(()=>{closeEndPoint(ep),isProxyReleased=!0});if("then"===prop){if(0===path.length)return{then:()=>proxy};const r=requestResponseMessage(ep,{type:0,path:path.map(p=>p.toString())}).then(fromWireValue);return r.then.bind(r)}return createProxy(ep,[...path,prop])},set(_target,prop,rawValue){throwIfProxyReleased(isProxyReleased);const[value,transferables]=toWireValue(rawValue);return requestResponseMessage(ep,{type:1,path:[...path,prop].map(p=>p.toString()),value:value},transferables).then(fromWireValue)},apply(_target,_thisArg,rawArgumentList){throwIfProxyReleased(isProxyReleased);const last=path[path.length-1];if(last===createEndpoint)return requestResponseMessage(ep,{type:4}).then(fromWireValue);if("bind"===last)return createProxy(ep,path.slice(0,-1));const[argumentList,transferables]=processArguments(rawArgumentList);return requestResponseMessage(ep,{type:2,path:path.map(p=>p.toString()),argumentList:argumentList},transferables).then(fromWireValue)},construct(_target,rawArgumentList){throwIfProxyReleased(isProxyReleased);const[argumentList,transferables]=processArguments(rawArgumentList);return requestResponseMessage(ep,{type:3,path:path.map(p=>p.toString()),argumentList:argumentList},transferables).then(fromWireValue)}});return proxy}(ep,[],void 0)}(port))}],["throw",{canHandle:obj=>throwSet.has(obj),serialize(obj){const isError=obj instanceof Error;let serialized=obj;return isError&&(serialized={isError:isError,message:obj.message,stack:obj.stack}),[serialized,[]]},deserialize(obj){if(obj.isError)throw Object.assign(new Error,obj);throw obj}}]]);function expose(obj,ep=self){ep.addEventListener("message",(function callback(ev){if(!ev||!ev.data)return;const{id:id,type:type,path:path}=Object.assign({path:[]},ev.data),argumentList=(ev.data.argumentList||[]).map(fromWireValue);let returnValue;try{const parent=path.slice(0,-1).reduce((obj,prop)=>obj[prop],obj),rawValue=path.reduce((obj,prop)=>obj[prop],obj);switch(type){case 0:returnValue=rawValue;break;case 1:parent[path.slice(-1)[0]]=fromWireValue(ev.data.value),returnValue=!0;break;case 2:returnValue=rawValue.apply(parent,argumentList);break;case 3:returnValue=function(obj){return Object.assign(obj,{[proxyMarker]:!0})}(new rawValue(...argumentList));break;case 4:{const{port1:port1,port2:port2}=new MessageChannel;expose(obj,port2),returnValue=function(obj,transfers){return transferCache.set(obj,transfers),obj}(port1,[port1])}break;case 5:returnValue=void 0}}catch(e){returnValue=e,throwSet.add(e)}Promise.resolve(returnValue).catch(e=>(throwSet.add(e),e)).then(returnValue=>{const[wireValue,transferables]=toWireValue(returnValue);ep.postMessage(Object.assign(Object.assign({},wireValue),{id:id}),transferables),5===type&&(ep.removeEventListener("message",callback),closeEndPoint(ep))})})),ep.start&&ep.start()}function closeEndPoint(endpoint){(function(endpoint){return"MessagePort"===endpoint.constructor.name})(endpoint)&&endpoint.close()}function throwIfProxyReleased(isReleased){if(isReleased)throw new Error("Proxy has been released and is not useable")}function processArguments(argumentList){const processed=argumentList.map(toWireValue);return[processed.map(v=>v[0]),(arr=processed.map(v=>v[1]),Array.prototype.concat.apply([],arr))];var arr}const transferCache=new WeakMap;function toWireValue(value){for(const[name,handler]of transferHandlers)if(handler.canHandle(value)){const[serializedValue,transferables]=handler.serialize(value);return[{type:3,name:name,value:serializedValue},transferables]}return[{type:0,value:value},transferCache.get(value)||[]]}function fromWireValue(value){switch(value.type){case 3:return transferHandlers.get(value.name).deserialize(value.value);case 0:return value.value}}function requestResponseMessage(ep,msg,transfers){return new Promise(resolve=>{const id=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");ep.addEventListener("message",(function l(ev){ev.data&&ev.data.id&&ev.data.id===id&&(ep.removeEventListener("message",l),resolve(ev.data))})),ep.start&&ep.start(),ep.postMessage(Object.assign({id:id},msg),transfers)})}var dsp=__webpack_require__("wTN2");class FuzzyHistogram{static calculatePeak(data,fuzz,atLeast){let candidateLengths=[];for(let item of data){let found=!1;for(let j=0;j<candidateLengths.length;j++){let current=candidateLengths[j],upper=current.value*(1+fuzz);if(item>=current.value*(1-fuzz)&&item<=upper){found=!0,current.count+=2,current.value=(current.value*(current.count-1)+item)/current.count,candidateLengths[j]=current;break}}found||candidateLengths.push({value:item,count:1})}candidateLengths.sort((a,b)=>b.count-a.count);for(let candidate of candidateLengths){let duration=candidate.value;if(duration>=atLeast)return duration}return atLeast}}class PitchDetector{static mikelsFrequency(fftMag,sampleRate,frameSize){let peaks=PitchDetector.calculatePeaks(fftMag,2,fftMag.length,0);peaks.sort((a,b)=>fftMag[b]-fftMag[a]);let maxEnergy=0,maxCandidate=0,binWidth=sampleRate/frameSize;for(let i=0;i<5;i++){let candidate=peaks[i],energy=0;for(let j=0;j<10;j++){let harmonic=candidate+j*candidate,hHigh=harmonic+2,maxLittleBit=-1;for(let k=harmonic-2;k<=hHigh;k++)k<fftMag.length&&fftMag[k]>maxLittleBit&&(maxLittleBit=fftMag[k]);energy+=maxLittleBit}energy>maxEnergy&&(maxEnergy=energy,maxCandidate=candidate)}return maxCandidate*binWidth}static calculatePeaks(data,border,howFar,thresholdNormal){let thresholdValue=0;if(thresholdNormal>0)for(let i=0;i<howFar;i++)data[i]>thresholdValue&&(thresholdValue=data[i]);thresholdValue*=thresholdNormal;let peaks=[];if(howFar>=border)for(let i=border;i<howFar-border;i++){let addPeak=!0;if(data[i]>=thresholdValue){for(let j=0;j<border;j++)if(data[i]<data[i-j]||data[i]<data[i+j]){addPeak=!1;break}}else addPeak=!1;addPeak&&peaks.push(i)}return peaks}}const RATIO=1.05946309436,RATIO_SQUARED=RATIO*RATIO,ABC_NOTE_RANGE=33,MIDI_NOTE_RANGE=87,MIDI_OFFSET=21,NOTE_NAMES=["D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D"],FUNDAMENTAL_FREQUENCIES={Bb:233.08,B:246.94,C:261.63,D:293.66,Eb:311.13,F:349.23,G:392};var PitchModel=function(PitchModel){return PitchModel[PitchModel.FLUTE=0]="FLUTE",PitchModel[PitchModel.WHISTLE=1]="WHISTLE",PitchModel}({});class PitchSpeller{constructor(fundamental="D",mode="major"){this.fundamentalFrequency=FUNDAMENTAL_FREQUENCIES[fundamental],this.pitchModel=PitchModel.FLUTE,this.knownFrequencies=new Array(ABC_NOTE_RANGE),this.midiNotes=new Array(MIDI_NOTE_RANGE),this.makeScale(mode),this.makeMidiNotes()}makeScale(mode){let majorKeyIntervals=[1,2,4,5];if("major"==mode){this.knownFrequencies[0]=this.pitchModel==PitchModel.FLUTE?this.fundamentalFrequency/Math.pow(RATIO,12):this.fundamentalFrequency;for(let i=1;i<this.knownFrequencies.length;i++)this.knownFrequencies[i]=PitchSpeller.isWholeToneInterval(i,majorKeyIntervals)?this.knownFrequencies[i-1]*RATIO_SQUARED:this.knownFrequencies[i-1]*RATIO}}static isWholeToneInterval(n,intervals){return n%=8,intervals.some(interval=>interval==n)}makeMidiNotes(){this.midiNotes[0]=27.5;for(let i=1;i<this.midiNotes.length;i++)this.midiNotes[i]=this.midiNotes[i-1]*RATIO}spellFrequency(frequency){let minIndex=0,minDiff=Number.MAX_VALUE;if(frequency<this.knownFrequencies[0]||frequency>this.knownFrequencies.slice(-1)[0])return"Z";for(let i=0;i<this.knownFrequencies.length;i++){let difference=Math.abs(frequency-this.knownFrequencies[i]);difference<minDiff&&(minIndex=i,minDiff=difference)}return NOTE_NAMES[minIndex]}spellFrequencyAsMidi(frequency){let minIndex=0,minDiff=Number.MAX_VALUE;if(frequency<this.midiNotes[0]||frequency>this.midiNotes.slice(-1)[0])return"Z";for(let i=0;i<this.midiNotes.length;i++){let difference=Math.abs(frequency-this.midiNotes[i]);difference<minDiff&&(minIndex=i,minDiff=difference)}return(minIndex+=MIDI_OFFSET).toString()}}const DEFAULT_SAMPLE_RATE=22050,DEFAULT_SAMPLE_TIME=12,DEFAULT_BLANK_TIME=2,DEFAULT_FUNDAMENTAL="D",DEFAULT_FRAME_SIZE="auto",OVERLAP=.75;class transcriber_Transcriber{constructor(params){this.inputSampleRate=void 0!==params.inputSampleRate?params.inputSampleRate:DEFAULT_SAMPLE_RATE,this.sampleTime=void 0!==params.sampleTime?params.sampleTime:DEFAULT_SAMPLE_TIME,this.blankTime=void 0!==params.blankTime?params.blankTime:DEFAULT_BLANK_TIME,this.fundamental=void 0!==params.fundamental?params.fundamental:DEFAULT_FUNDAMENTAL,this.enableSampleRateConversion=void 0!==params.enableSampleRateConversion&&params.enableSampleRateConversion,this.frameSize=void 0!==params.frameSize?params.frameSize:DEFAULT_FRAME_SIZE,this.onProgress=void 0!==params.onProgress?params.onProgress:x=>{},this.outputSampleRate=this.enableSampleRateConversion?DEFAULT_SAMPLE_RATE:this.inputSampleRate,this.numInputSamples=this.inputSampleRate*(this.blankTime+this.sampleTime),this.numOutputSamples=this.outputSampleRate*(this.blankTime+this.sampleTime),"auto"===this.frameSize&&(this.frameSize=this.calcFrameSize(this.outputSampleRate)),this.hopSize=this.frameSize*(1-OVERLAP),console.log("Frame size and hop size:",this.frameSize,this.hopSize),this.windowFunction=new dsp.WindowFunction(dsp.DSP.HANN),this.powerSpectrum=new dsp.FFT(this.frameSize,this.outputSampleRate)}transcribe(signal,midi=!1){this.signal=this.enableSampleRateConversion?this.convertSampleRate(signal):signal;let speller=new PitchSpeller(this.fundamental),numHops=Math.floor((this.outputSampleRate*this.sampleTime-this.frameSize)/this.hopSize)+1,notes=[],lastNote="";const numBlankSamples=this.blankTime*this.outputSampleRate;for(let i=0;i<numHops;i++){if(this.interrupted)return"";let startAt=numBlankSamples+this.hopSize*i;this.progress=i/numHops,this.onProgress(this.progress);let frame=this.signal.slice(startAt,startAt+this.frameSize);if(frame.length!=this.frameSize)continue;this.windowFunction.process(frame);let spectrum=this.powerSpectrum.forward(frame),frequency=PitchDetector.mikelsFrequency(spectrum,this.outputSampleRate,this.frameSize),currentNote=midi?speller.spellFrequencyAsMidi(frequency):speller.spellFrequency(frequency);currentNote!=lastNote&&(lastNote=currentNote,notes.push({spelling:currentNote,frequency:frequency,onset:startAt/this.outputSampleRate}))}return this.postProcess(notes,midi)}convertSampleRate(inSignal){let outSignal=new Float32Array(this.numOutputSamples),end=0;for(let i=0;i<outSignal.length;i++){let begin=end;end=Math.floor((i+1)*this.inputSampleRate/this.outputSampleRate);let sum=0;for(let j=begin;j<end;j++)sum+=inSignal[j];outSignal[i]=sum/(end-begin)}return outSignal}postProcess(notes,midi){let transcription="";for(let i=0;i<notes.length-1;i++)notes[i].duration=notes[i+1].onset-notes[i].onset,notes[i].duration<0&&console.log(notes[i+1].onset,notes[i].onset);notes.slice(-1)[0].duration=this.blankTime+this.sampleTime-notes.slice(-1)[0].onset;let durations=new Array(notes.length);for(let i=0;i<notes.length;i++)durations[i]=notes[i].duration;let quaverLength=FuzzyHistogram.calculatePeak(durations,.33,.1);for(let note of notes){if("Z"==note.spelling)continue;note.qq=Math.round(note.duration/quaverLength);let spelling=note.spelling;midi&&(spelling+=","),transcription+=spelling=spelling.repeat(note.qq)}return transcription}calcFrameSize(sampleRate){const idealFrameSize=sampleRate/10,prev=this.prevPow2(idealFrameSize),next=2*prev;return next-idealFrameSize<prev-idealFrameSize?next:prev}prevPow2(v){return Math.pow(2,Math.floor(Math.log(v)/Math.log(2)))}}__webpack_require__.d(__webpack_exports__,"TranscriberImpl",(function(){return transcriber_worker_TranscriberImpl}));class transcriber_worker_TranscriberImpl{initialize(initParams){this.transcriber=new transcriber_Transcriber(initParams),this.resetSignal()}resetSignal(){this.signal=[],this.currNumSamples=0}mergeSignal(){let length=this.transcriber.numInputSamples,signal=new Float32Array(length),currNumSamples=0;for(let buffer of this.signal){let newNumSamples=currNumSamples+buffer.length;signal.set(newNumSamples<=length?buffer:buffer.subarray(0,length-currNumSamples),currNumSamples),currNumSamples=newNumSamples}return signal}transcribe(signal,midi=!1){let theSignal=signal||this.mergeSignal(),transcription=this.transcriber.transcribe(theSignal,midi);return console.log(`Worker: transcription: ${transcription}`),{transcription:transcription,sampleRate:this.transcriber.outputSampleRate,numSamples:this.transcriber.numOutputSamples}}pushSignal(signal){this.signal.push(signal),this.currNumSamples+=signal.length;let largest=Number.MIN_VALUE;for(let sample of signal)sample>largest&&(largest=sample);return{amplitude:largest,timeRecorded:this.currNumSamples/this.transcriber.inputSampleRate,isBufferFull:this.currNumSamples>=this.transcriber.numInputSamples}}}expose(new transcriber_worker_TranscriberImpl)}});