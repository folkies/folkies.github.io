(()=>{var ct={2054:H=>{var e,i,t,a,h={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};function G(e,i){"function"!=typeof this[e]&&"object"!=typeof this[e]&&(this[e]="function"==typeof this[i]&&"object"!=typeof this[i]?this[i]:function(t){return t instanceof Array?t:"number"==typeof t?new Array(t):void 0})}function Q(e,i){this.bufferSize=e,this.sampleRate=i,this.bandwidth=2/e*i/2,this.spectrum=new Float32Array(e/2),this.real=new Float32Array(e),this.imag=new Float32Array(e),this.peakBand=0,this.peak=0,this.getBandFrequency=function(t){return this.bandwidth*t+this.bandwidth/2},this.calculateSpectrum=function(){for(var p,g,d,t=this.spectrum,a=this.real,s=this.imag,r=2/this.bufferSize,o=Math.sqrt,y=0,N=e/2;y<N;y++)(d=r*o((p=a[y])*p+(g=s[y])*g))>this.peak&&(this.peakBand=y,this.peak=d),t[y]=d;return t}}function tt(e,i){Q.call(this,e,i);var t=e/2*e,a=2*Math.PI;this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t);for(var s=0;s<t;s++)this.sinTable[s]=Math.sin(s*a/e),this.cosTable[s]=Math.cos(s*a/e)}function et(e,i){Q.call(this,e,i),this.reverseTable=new Uint32Array(e);for(var s,t=1,a=e>>1;t<e;){for(s=0;s<t;s++)this.reverseTable[s+t]=this.reverseTable[s]+a;t<<=1,a>>=1}for(this.sinTable=new Float32Array(e),this.cosTable=new Float32Array(e),s=0;s<e;s++)this.sinTable[s]=Math.sin(-Math.PI/s),this.cosTable[s]=Math.cos(-Math.PI/s)}function at(e,i){Q.call(this,e,i),this.trans=new Float32Array(e),this.reverseTable=new Uint32Array(e),this.reverseBinPermute=function(t,a,s){var y,r=this.bufferSize,o=r>>>1,p=r-1,g=1,d=0;t[0]=a[s=void 0!==s?s:0];do{for(t[g]=a[s+(d+=o)],t[d]=a[s+g],g++,y=o<<1;!((d^=y>>=1)&y););d>=g&&(t[g]=a[s+d],t[d]=a[s+g],t[p-g]=a[s+p-d],t[p-d]=a[s+p-g]),g++}while(g<o);t[p]=a[s+p]},this.generateReverseTable=function(){var p,t=this.bufferSize,a=t>>>1,s=t-1,r=1,o=0;this.reverseTable[0]=0;do{for(this.reverseTable[r]=o+=a,this.reverseTable[o]=r,r++,p=a<<1;!((o^=p>>=1)&p););o>=r&&(this.reverseTable[r]=o,this.reverseTable[o]=r,this.reverseTable[s-r]=s-o,this.reverseTable[s-o]=s-r),r++}while(r<a);this.reverseTable[s]=s},this.generateReverseTable()}function U(e,i,t,a,s,r,o,p){this.file=e,this.bufferSize=i,this.sampleRate=t,this.playStart=a||0,this.playEnd=s||1,this.loopStart=r||0,this.loopEnd=o||1,this.loopMode=p||h.OFF,this.loaded=!1,this.samples=[],this.signal=new Float32Array(i),this.frameCount=0,this.envelope=null,this.amplitude=1,this.rootFrequency=110,this.frequency=550,this.step=this.frequency/this.rootFrequency,this.duration=0,this.samplesProcessed=0,this.playhead=0;var g=document.createElement("AUDIO"),d=this;this.loadSamples=function(y){for(var N=h.getChannel(h.MIX,y.frameBuffer),k=0;k<N.length;k++)d.samples.push(N[k])},this.loadComplete=function(){d.samples=new Float32Array(d.samples),d.loaded=!0},this.loadMetaData=function(){d.duration=g.duration},g.addEventListener("MozAudioAvailable",this.loadSamples,!1),g.addEventListener("loadedmetadata",this.loadMetaData,!1),g.addEventListener("ended",this.loadComplete,!1),g.muted=!0,g.src=e,g.play()}function L(e,i,t,a,s){switch(this.frequency=i,this.amplitude=t,this.bufferSize=a,this.sampleRate=s,this.frameCount=0,this.waveTableLength=2048,this.cyclesPerSample=i/s,this.signal=new Float32Array(a),this.envelope=null,parseInt(e,10)){case h.TRIANGLE:this.func=L.Triangle;break;case h.SAW:this.func=L.Saw;break;case h.SQUARE:this.func=L.Square;break;default:this.func=L.Sine}this.generateWaveTable=function(){L.waveTable[this.func]=new Float32Array(2048);for(var o=1/(this.waveTableLength/this.sampleRate),p=0;p<this.waveTableLength;p++)L.waveTable[this.func][p]=this.func(p*o/this.sampleRate)},void 0===L.waveTable&&(L.waveTable={}),void 0===L.waveTable[this.func]&&this.generateWaveTable(),this.waveTable=L.waveTable[this.func]}function B(e,i,t,a,s,r){this.sampleRate=r,this.attackLength=e,this.decayLength=i,this.sustainLevel=t,this.sustainLength=a,this.releaseLength=s,this.sampleRate=r,this.attackSamples=e*r,this.decaySamples=i*r,this.sustainSamples=a*r,this.releaseSamples=s*r,this.update=function(){this.attack=this.attackSamples,this.decay=this.attack+this.decaySamples,this.sustain=this.decay+this.sustainSamples,this.release=this.sustain+this.releaseSamples},this.update(),this.samplesProcessed=0}function W(e,i,t,a){switch(this.sampleRate=a,e){case h.LOWPASS:case h.LP12:this.func=new W.LP12(i,t,a)}}function V(e,i,t,a){this.type=e,this.cutoff=i,this.resonance=t,this.sampleRate=a,this.f=Float32Array(4),this.f[0]=0,this.f[1]=0,this.f[2]=0,this.f[3]=0,this.calcCoeff=function(s,r){this.freq=2*Math.sin(Math.PI*Math.min(.25,s/(2*this.sampleRate))),this.damp=Math.min(2*(1-Math.pow(r,.25)),Math.min(2,2/this.freq-.5*this.freq))},this.calcCoeff(i,t)}function I(e,i){switch(this.alpha=i,e){case h.BARTLETT:this.func=I.Bartlett;break;case h.BARTLETTHANN:this.func=I.BartlettHann;break;case h.BLACKMAN:this.func=I.Blackman,this.alpha=this.alpha||.16;break;case h.COSINE:this.func=I.Cosine;break;case h.GAUSS:this.func=I.Gauss,this.alpha=this.alpha||.25;break;case h.HAMMING:this.func=I.Hamming;break;case h.HANN:this.func=I.Hann;break;case h.LANCZOS:this.func=I.Lanczoz;break;case h.RECTANGULAR:this.func=I.Rectangular;break;case h.TRIANGULAR:this.func=I.Triangular}}function Z(e){return(Math.exp(e)-Math.exp(-e))/2}function rt(e,i){this.Fs=i,this.type=e,this.parameterType=h.Q,this.x_1_l=0,this.x_2_l=0,this.y_1_l=0,this.y_2_l=0,this.x_1_r=0,this.x_2_r=0,this.y_1_r=0,this.y_2_r=0,this.b0=1,this.a0=1,this.b1=0,this.a1=0,this.b2=0,this.a2=0,this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0,this.f0=3e3,this.dBgain=12,this.Q=1,this.BW=-3,this.S=1,this.coefficients=function(){return{b:[this.b0,this.b1,this.b2],a:[this.a0,this.a1,this.a2]}},this.setFilterType=function(t){this.type=t,this.recalculateCoefficients()},this.setSampleRate=function(t){this.Fs=t,this.recalculateCoefficients()},this.setQ=function(t){this.parameterType=h.Q,this.Q=Math.max(Math.min(t,115),.001),this.recalculateCoefficients()},this.setBW=function(t){this.parameterType=h.BW,this.BW=t,this.recalculateCoefficients()},this.setS=function(t){this.parameterType=h.S,this.S=Math.max(Math.min(t,5),1e-4),this.recalculateCoefficients()},this.setF0=function(t){this.f0=t,this.recalculateCoefficients()},this.setDbGain=function(t){this.dBgain=t,this.recalculateCoefficients()},this.recalculateCoefficients=function(){var t;t=e===h.PEAKING_EQ||e===h.LOW_SHELF||e===h.HIGH_SHELF?Math.pow(10,this.dBgain/40):Math.sqrt(Math.pow(10,this.dBgain/20));var p,a=h.TWO_PI*this.f0/this.Fs,s=Math.cos(a),r=Math.sin(a),o=0;switch(this.parameterType){case h.Q:o=r/(2*this.Q);break;case h.BW:o=r*Z(Math.LN2/2*this.BW*a/r);break;case h.S:o=r/2*Math.sqrt((t+1/t)*(1/this.S-1)+2)}switch(this.type){case h.LPF:this.b0=(1-s)/2,this.b1=1-s,this.b2=(1-s)/2,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.HPF:this.b0=(1+s)/2,this.b1=-(1+s),this.b2=(1+s)/2,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.BPF_CONSTANT_SKIRT:this.b0=r/2,this.b1=0,this.b2=-r/2,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.BPF_CONSTANT_PEAK:this.b0=o,this.b1=0,this.b2=-o,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.NOTCH:this.b0=1,this.b1=-2*s,this.b2=1,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.APF:this.b0=1-o,this.b1=-2*s,this.b2=1+o,this.a0=1+o,this.a1=-2*s,this.a2=1-o;break;case h.PEAKING_EQ:this.b0=1+o*t,this.b1=-2*s,this.b2=1-o*t,this.a0=1+o/t,this.a1=-2*s,this.a2=1-o/t;break;case h.LOW_SHELF:p=r*Math.sqrt((3^t)*(1/this.S-1)+2*t),this.b0=t*(t+1-(t-1)*s+p),this.b1=2*t*(t-1-(t+1)*s),this.b2=t*(t+1-(t-1)*s-p),this.a0=t+1+(t-1)*s+p,this.a1=-2*(t-1+(t+1)*s),this.a2=t+1+(t-1)*s-p;break;case h.HIGH_SHELF:p=r*Math.sqrt((3^t)*(1/this.S-1)+2*t),this.b0=t*(t+1+(t-1)*s+p),this.b1=-2*t*(t-1+(t+1)*s),this.b2=t*(t+1+(t-1)*s-p),this.a0=t+1-(t-1)*s+p,this.a1=2*(t-1-(t+1)*s),this.a2=t+1-(t-1)*s-p}this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0},this.process=function(t){for(var s=new Float32Array(t.length),r=0;r<t.length;r++)s[r]=this.b0a0*t[r]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=s[r],this.x_2_l=this.x_1_l,this.x_1_l=t[r];return s},this.processStereo=function(t){for(var a=t.length,s=new Float32Array(a),r=0;r<a/2;r++)s[2*r]=this.b0a0*t[2*r]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=s[2*r],this.x_2_l=this.x_1_l,this.x_1_l=t[2*r],s[2*r+1]=this.b0a0*t[2*r+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r,this.y_2_r=this.y_1_r,this.y_1_r=s[2*r+1],this.x_2_r=this.x_1_r,this.x_1_r=t[2*r+1];return s}}function z(e,i,t,a){this.delayBufferSamples=new Float32Array(e),this.delayInputPointer=i,this.delayOutputPointer=0,this.delayInSamples=i,this.masterVolume=t,this.delayVolume=a}function Y(e,i,t){this.delayBufferSamples=new Float32Array(e),this.delayInputPointer=i,this.delayOutputPointer=0,this.delayInSamples=i,this.delayVolume=t}function x(e,i,t,a,s,r){var o,p;for(this.delayInSamples=i,this.masterVolume=t,this.mixVolume=a,this.delayVolume=s,this.dampFrequency=r,this.NR_OF_MULTIDELAYS=6,this.NR_OF_SINGLEDELAYS=6,this.LOWPASSL=new V(h.LOWPASS,r,0,44100),this.LOWPASSR=new V(h.LOWPASS,r,0,44100),this.singleDelays=[],o=0;o<this.NR_OF_SINGLEDELAYS;o++)p=1+o/7,this.singleDelays[o]=new Y(e,Math.round(this.delayInSamples*p),this.delayVolume);for(this.multiDelays=[],o=0;o<this.NR_OF_MULTIDELAYS;o++)p=1+o/10,this.multiDelays[o]=new z(e,Math.round(this.delayInSamples*p),this.masterVolume,this.delayVolume)}G("Float32Array","WebGLFloatArray"),G("Int32Array","WebGLIntArray"),G("Uint16Array","WebGLUnsignedShortArray"),G("Uint8Array","WebGLUnsignedByteArray"),h.invert=function(e){for(var i=0,t=e.length;i<t;i++)e[i]*=-1;return e},h.interleave=function(e,i){if(e.length!==i.length)throw"Can not interleave. Channel lengths differ.";for(var t=new Float32Array(2*e.length),a=0,s=e.length;a<s;a++)t[2*a]=e[a],t[2*a+1]=i[a];return t},h.deinterleave=((a=[])[h.MIX]=function(s){for(var r=0,o=s.length/2;r<o;r++)t[r]=(s[2*r]+s[2*r+1])/2;return t},a[h.LEFT]=function(s){for(var r=0,o=s.length/2;r<o;r++)e[r]=s[2*r];return e},a[h.RIGHT]=function(s){for(var r=0,o=s.length/2;r<o;r++)i[r]=s[2*r+1];return i},function(s,r){return e=e||new Float32Array(r.length/2),i=i||new Float32Array(r.length/2),t=t||new Float32Array(r.length/2),r.length/2!==e.length&&(e=new Float32Array(r.length/2),i=new Float32Array(r.length/2),t=new Float32Array(r.length/2)),a[s](r)}),h.getChannel=h.deinterleave,h.mixSampleBuffers=function(e,i,t,a){for(var s=new Float32Array(e),r=0;r<e.length;r++)s[r]+=(t?-i[r]:i[r])/a;return s},h.LPF=0,h.HPF=1,h.BPF_CONSTANT_SKIRT=2,h.BPF_CONSTANT_PEAK=3,h.NOTCH=4,h.APF=5,h.PEAKING_EQ=6,h.LOW_SHELF=7,h.HIGH_SHELF=8,h.Q=1,h.BW=2,h.S=3,h.RMS=function(e){for(var i=0,t=0,a=e.length;t<a;t++)i+=e[t]*e[t];return Math.sqrt(i/a)},h.Peak=function(e){for(var i=0,t=0,a=e.length;t<a;t++)i=Math.abs(e[t])>i?Math.abs(e[t]):i;return i},tt.prototype.forward=function(e){for(var a,s,i=this.real,t=this.imag,r=0;r<this.bufferSize/2;r++){a=0,s=0;for(var o=0;o<e.length;o++)a+=this.cosTable[r*o]*e[o],s+=this.sinTable[r*o]*e[o];i[r]=a,t[r]=s}return this.calculateSpectrum()},et.prototype.forward=function(e){var i=this.bufferSize,t=this.cosTable,a=this.sinTable,s=this.reverseTable,r=this.real,o=this.imag,g=Math.floor(Math.log(i)/Math.LN2);if(Math.pow(2,g)!==i)throw"Invalid buffer size, must be a power of 2.";if(i!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+i+" Buffer Size: "+e.length;var y,N,k,M,O,q,b,R,w,d=1;for(w=0;w<i;w++)r[w]=e[s[w]],o[w]=0;for(;d<i;){y=t[d],N=a[d],k=1,M=0;for(var E=0;E<d;E++){for(w=E;w<i;)b=k*o[O=w+d]+M*r[O],r[O]=r[w]-(q=k*r[O]-M*o[O]),o[O]=o[w]-b,r[w]+=q,o[w]+=b,w+=d<<1;k=(R=k)*y-M*N,M=R*N+M*y}d<<=1}return this.calculateSpectrum()},et.prototype.inverse=function(e,i){var t=this.bufferSize,a=this.cosTable,s=this.sinTable,r=this.reverseTable;e=e||this.real,i=i||this.imag;var g,d,y,N,k,M,O,q,b,p=1;for(b=0;b<t;b++)i[b]*=-1;var R=new Float32Array(t),w=new Float32Array(t);for(b=0;b<e.length;b++)R[b]=e[r[b]],w[b]=i[r[b]];for(e=R,i=w;p<t;){g=a[p],d=s[p],y=1,N=0;for(var E=0;E<p;E++){for(b=E;b<t;)O=y*i[k=b+p]+N*e[k],e[k]=e[b]-(M=y*e[k]-N*i[k]),i[k]=i[b]-O,e[b]+=M,i[b]+=O,b+=p<<1;y=(q=y)*g-N*d,N=q*d+N*g}p<<=1}var D=new Float32Array(t);for(b=0;b<t;b++)D[b]=e[b]/t;return D},at.prototype.forward=function(e,i){i=void 0!==i?i:0;var d,y,N,k,M,O,q,b,R,w,E,D,$,K,j,J,l,n,c,u,m,v,f,S,T,P,t=this.bufferSize,a=this.spectrum,s=this.trans,r=2*Math.PI,o=Math.sqrt,p=t>>>1,g=2/t;this.reverseBinPermute(s,e,i);for(var A=0,F=4;A<t;F*=4){for(var _=A;_<t;_+=F)l=s[_]-s[_+1],s[_]+=s[_+1],s[_+1]=l;A=2*(F-1)}for(d=2,k=t>>>1;k>>>=1;){A=0,F=(d<<=1)<<1,y=d>>>2,N=d>>>3;do{if(1!==y)for(_=A;_<t;_+=F)M=s[E=(w=(R=_)+y)+y]+s[D=E+y],s[D]-=s[E],s[E]=s[R]-M,s[R]+=M,R+=N,w+=N,O=s[E+=N]-s[D+=N],M=-(M=s[E]+s[D])*Math.SQRT1_2,O*=Math.SQRT1_2,s[D]=M+(l=s[w]),s[E]=M-l,s[w]=s[R]-O,s[R]+=O;else for(_=A;_<t;_+=F)M=s[E=(w=(R=_)+y)+y]+s[D=E+y],s[D]-=s[E],s[E]=s[R]-M,s[R]+=M;A=(F<<1)-d,F<<=2}while(A<t);v=r/d;for(var C=1;C<N;C++){f=C*v,c=Math.sin(f),u=4*(n=Math.cos(f))*(n*n-.75),m=4*c*(.75-c*c),A=0,F=d<<1;do{for(_=A;_<t;_+=F)M=s[j=(K=($=_+y-C)+y)+y]*c+s[E=(w=(R=_+C)+y)+y]*n,q=s[J=j+y]*m+s[D=E+y]*u,l=(O=s[j]*n-s[E]*c)-(b=s[J]*u-s[D]*m),O+=b,b=l,s[J]=O+s[K],s[E]=O-s[K],l=q-M,M+=q,s[D]=(q=l)+s[w],s[j]=q-s[w],s[K]=s[R]-M,s[R]+=M,s[w]=b+s[$],s[$]-=b;A=(F<<1)-d,F<<=2}while(A<t)}}for(;--p;)(P=g*o((S=s[p])*S+(T=s[t-p-1])*T))>this.peak&&(this.peakBand=p,this.peak=P),a[p]=P;return a[0]=g*s[0],a},U.prototype.applyEnvelope=function(){return this.envelope.process(this.signal),this.signal},U.prototype.generate=function(){for(var i=this.playEnd*this.samples.length-this.playStart*this.samples.length,t=this.playStart*this.samples.length,a=this.playEnd*this.samples.length,r=0;r<this.bufferSize;r++){switch(this.loopMode){case h.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+t),this.signal[r]=this.playhead<this.playEnd*this.samples.length?this.samples[this.playhead]*this.amplitude:0;break;case h.FW:this.playhead=Math.round(this.samplesProcessed*this.step%i+t),this.playhead<this.playEnd*this.samples.length&&(this.signal[r]=this.samples[this.playhead]*this.amplitude);break;case h.BW:this.playhead=a-Math.round(this.samplesProcessed*this.step%i),this.playhead<this.playEnd*this.samples.length&&(this.signal[r]=this.samples[this.playhead]*this.amplitude);break;case h.FWBW:this.playhead=Math.floor(this.samplesProcessed*this.step/i)%2==0?Math.round(this.samplesProcessed*this.step%i+t):a-Math.round(this.samplesProcessed*this.step%i),this.playhead<this.playEnd*this.samples.length&&(this.signal[r]=this.samples[this.playhead]*this.amplitude)}this.samplesProcessed++}return this.frameCount++,this.signal},U.prototype.setFreq=function(e){var i=this.samplesProcessed*this.step;this.frequency=e,this.step=this.frequency/this.rootFrequency,this.samplesProcessed=Math.round(i/this.step)},U.prototype.reset=function(){this.samplesProcessed=0,this.playhead=0},L.prototype.setAmp=function(e){if(!(e>=0&&e<=1))throw"Amplitude out of range (0..1).";this.amplitude=e},L.prototype.setFreq=function(e){this.frequency=e,this.cyclesPerSample=e/this.sampleRate},L.prototype.add=function(e){for(var i=0;i<this.bufferSize;i++)this.signal[i]+=e.signal[i];return this.signal},L.prototype.addSignal=function(e){for(var i=0;i<e.length&&!(i>=this.bufferSize);i++)this.signal[i]+=e[i];return this.signal},L.prototype.addEnvelope=function(e){this.envelope=e},L.prototype.applyEnvelope=function(){this.envelope.process(this.signal)},L.prototype.valueAt=function(e){return this.waveTable[e%this.waveTableLength]},L.prototype.generate=function(){for(var t,e=this.frameCount*this.bufferSize,i=this.waveTableLength*this.frequency/this.sampleRate,a=0;a<this.bufferSize;a++)t=Math.round((e+a)*i),this.signal[a]=this.waveTable[t%this.waveTableLength]*this.amplitude;return this.frameCount++,this.signal},L.Sine=function(e){return Math.sin(h.TWO_PI*e)},L.Square=function(e){return e<.5?1:-1},L.Saw=function(e){return 2*(e-Math.round(e))},L.Triangle=function(e){return 1-4*Math.abs(Math.round(e)-e)},L.Pulse=function(e){},B.prototype.noteOn=function(){this.samplesProcessed=0,this.sustainSamples=this.sustainLength*this.sampleRate,this.update()},B.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples,this.update()},B.prototype.processSample=function(e){var i=0;return this.samplesProcessed<=this.attack?i=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?i=1+(this.samplesProcessed-this.attack)/(this.decay-this.attack)*(this.sustainLevel-1):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?i=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(i=this.sustainLevel+(this.samplesProcessed-this.sustain)/(this.release-this.sustain)*(0-this.sustainLevel)),e*i},B.prototype.value=function(){var e=0;return this.samplesProcessed<=this.attack?e=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?e=1+(this.samplesProcessed-this.attack)/(this.decay-this.attack)*(this.sustainLevel-1):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?e=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(e=this.sustainLevel+(this.samplesProcessed-this.sustain)/(this.release-this.sustain)*(0-this.sustainLevel)),e},B.prototype.process=function(e){for(var i=0;i<e.length;i++)e[i]*=this.value(),this.samplesProcessed++;return e},B.prototype.isActive=function(){return!(this.samplesProcessed>this.release||-1===this.samplesProcessed)},B.prototype.disable=function(){this.samplesProcessed=-1},W.prototype.__defineGetter__("cutoff",function(){return this.func.cutoff}),W.prototype.__defineGetter__("resonance",function(){return this.func.resonance}),W.prototype.set=function(e,i){this.func.calcCoeff(e,i)},W.prototype.process=function(e){this.func.process(e)},W.prototype.addEnvelope=function(e){if(!(e instanceof B))throw"Not an envelope.";this.func.addEnvelope(e)},(W.LP12=function(e,i,t){this.sampleRate=t,this.vibraPos=0,this.vibraSpeed=0,this.envelope=!1,this.calcCoeff=function(a,s){this.w=2*Math.PI*a/this.sampleRate,this.q=1-this.w/(2*(s+.5/(1+this.w))+this.w-2),this.r=this.q*this.q,this.c=this.r+1-2*Math.cos(this.w)*this.q,this.cutoff=a,this.resonance=s},this.calcCoeff(e,i),this.process=function(a){for(var s=0;s<a.length;s++)this.vibraSpeed+=(a[s]-this.vibraPos)*this.c,this.vibraPos+=this.vibraSpeed,this.vibraSpeed*=this.r,this.envelope?(a[s]=a[s]*(1-this.envelope.value())+this.vibraPos*this.envelope.value(),this.envelope.samplesProcessed++):a[s]=this.vibraPos}}).prototype.addEnvelope=function(e){this.envelope=e},V.prototype.process=function(e){for(var i,t,a=this.f,s=0;s<e.length;s++)a[3]=(i=e[s])-this.damp*a[2],a[0]=a[0]+this.freq*a[2],a[1]=a[3]-a[0],a[2]=this.freq*a[1]+a[2],t=.5*a[this.type],a[3]=i-this.damp*a[2],a[0]=a[0]+this.freq*a[2],a[1]=a[3]-a[0],a[2]=this.freq*a[1]+a[2],t+=.5*a[this.type],this.envelope?(e[s]=e[s]*(1-this.envelope.value())+t*this.envelope.value(),this.envelope.samplesProcessed++):e[s]=t},V.prototype.addEnvelope=function(e){if(!(e instanceof B))throw"This is not an envelope.";this.envelope=e},V.prototype.set=function(e,i){this.calcCoeff(e,i)},I.prototype.process=function(e,i,t){t=void 0!==t?t:e.length;for(var a=i=void 0!==i?i:0;a<t;a++)e[a]*=this.func(t,a,this.alpha);return e},I.Bartlett=function(e,i){return 2/(e-1)*((e-1)/2-Math.abs(i-(e-1)/2))},I.BartlettHann=function(e,i){return.62-.48*Math.abs(i/(e-1)-.5)-.38*Math.cos(h.TWO_PI*i/(e-1))},I.Blackman=function(e,i,t){var r=t/2;return(1-t)/2-.5*Math.cos(h.TWO_PI*i/(e-1))+r*Math.cos(4*Math.PI*i/(e-1))},I.Cosine=function(e,i){return Math.cos(Math.PI*i/(e-1)-Math.PI/2)},I.Gauss=function(e,i,t){return Math.pow(Math.E,-.5*Math.pow((i-(e-1)/2)/(t*(e-1)/2),2))},I.Hamming=function(e,i){return.54-.46*Math.cos(h.TWO_PI*i/(e-1))},I.Hann=function(e,i){return.5*(1-Math.cos(h.TWO_PI*i/(e-1)))},I.Lanczos=function(e,i){var t=2*i/(e-1)-1;return Math.sin(Math.PI*t)/(Math.PI*t)},I.Rectangular=function(e,i){return 1},I.Triangular=function(e,i){return 2/e*(e/2-Math.abs(i-(e-1)/2))},h.mag2db=function(e){for(var t=Math.pow(10,-6),a=Math.log,s=Math.max,r=Float32Array(e.length),o=0;o<e.length;o++)r[o]=20*a(s(e[o],t));return r},h.freqz=function(e,i,t){var a,s;if(!t)for(t=Float32Array(200),a=0;a<t.length;a++)t[a]=h.TWO_PI/t.length*a-Math.PI;var r=Float32Array(t.length),o=Math.sqrt,p=Math.cos,g=Math.sin;for(a=0;a<t.length;a++){var d={real:0,imag:0};for(s=0;s<e.length;s++)d.real+=e[s]*p(-s*t[a]),d.imag+=e[s]*g(-s*t[a]);var y={real:0,imag:0};for(s=0;s<i.length;s++)y.real+=i[s]*p(-s*t[a]),y.imag+=i[s]*g(-s*t[a]);r[a]=o(d.real*d.real+d.imag*d.imag)/o(y.real*y.real+y.imag*y.imag)}return r},z.prototype.setDelayInSamples=function(e){this.delayInSamples=e,this.delayInputPointer=this.delayOutputPointer+e,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},z.prototype.setMasterVolume=function(e){this.masterVolume=e},z.prototype.setDelayVolume=function(e){this.delayVolume=e},z.prototype.process=function(e){for(var i=new Float32Array(e.length),t=0;t<e.length;t++){var s=(null===this.delayBufferSamples[this.delayOutputPointer]?0:this.delayBufferSamples[this.delayOutputPointer])*this.delayVolume+e[t];this.delayBufferSamples[this.delayInputPointer]=s,i[t]=s*this.masterVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return i},Y.prototype.setDelayInSamples=function(e){this.delayInSamples=e,this.delayInputPointer=this.delayOutputPointer+e,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},Y.prototype.setDelayVolume=function(e){this.delayVolume=e},Y.prototype.process=function(e){for(var i=new Float32Array(e.length),t=0;t<e.length;t++)this.delayBufferSamples[this.delayInputPointer]=e[t],i[t]=this.delayBufferSamples[this.delayOutputPointer]*this.delayVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0);return i},x.prototype.setDelayInSamples=function(e){var i,t;for(this.delayInSamples=e,i=0;i<this.NR_OF_SINGLEDELAYS;i++)t=1+i/7,this.singleDelays[i].setDelayInSamples(Math.round(this.delayInSamples*t));for(i=0;i<this.NR_OF_MULTIDELAYS;i++)t=1+i/10,this.multiDelays[i].setDelayInSamples(Math.round(this.delayInSamples*t))},x.prototype.setMasterVolume=function(e){this.masterVolume=e},x.prototype.setMixVolume=function(e){this.mixVolume=e},x.prototype.setDelayVolume=function(e){var i;for(this.delayVolume=e,i=0;i<this.NR_OF_SINGLEDELAYS;i++)this.singleDelays[i].setDelayVolume(this.delayVolume);for(i=0;i<this.NR_OF_MULTIDELAYS;i++)this.multiDelays[i].setDelayVolume(this.delayVolume)},x.prototype.setDampFrequency=function(e){this.dampFrequency=e,this.LOWPASSL.set(e,0),this.LOWPASSR.set(e,0)},x.prototype.process=function(e){var i=new Float32Array(e.length),t=h.deinterleave(e);this.LOWPASSL.process(t[h.LEFT]),this.LOWPASSR.process(t[h.RIGHT]);var s,a=h.interleave(t[h.LEFT],t[h.RIGHT]);for(s=0;s<this.NR_OF_MULTIDELAYS;s++)i=h.mixSampleBuffers(i,this.multiDelays[s].process(a),2%s==0,this.NR_OF_MULTIDELAYS);var r=new Float32Array(i.length);for(s=0;s<this.NR_OF_SINGLEDELAYS;s++)r=h.mixSampleBuffers(r,this.singleDelays[s].process(i),2%s==0,1);for(s=0;s<r.length;s++)r[s]*=this.mixVolume;for(i=h.mixSampleBuffers(r,e,0,1),s=0;s<i.length;s++)i[s]*=this.masterVolume;return i},void 0!==H.exports&&(H.exports={DSP:h,DFT:tt,FFT:et,RFFT:at,Sampler:U,Oscillator:L,ADSR:B,IIRFilter:W,IIRFilter2:V,WindowFunction:I,sinh:Z,Biquad:rt,GraphicalEq:function nt(e){this.FS=e,this.minFreq=40,this.maxFreq=16e3,this.bandsPerOctave=1,this.filters=[],this.freqzs=[],this.calculateFreqzs=!0,this.recalculateFilters=function(){var i=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var t=0;t<i;t++){var a=this.minFreq*Math.pow(2,t/this.bandsPerOctave),s=new rt(h.PEAKING_EQ,this.FS);s.setDbGain(0),s.setBW(1/this.bandsPerOctave),s.setF0(a),this.filters[t]=s,this.recalculateFreqz(t)}},this.setMinimumFrequency=function(i){this.minFreq=i,this.recalculateFilters()},this.setMaximumFrequency=function(i){this.maxFreq=i,this.recalculateFilters()},this.setBandsPerOctave=function(i){this.bandsPerOctave=i,this.recalculateFilters()},this.setBandGain=function(i,t){if(i<0||i>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds.";if(!t)throw"A gain must be passed.";this.filters[i].setDbGain(t),this.recalculateFreqz(i)},this.recalculateFreqz=function(i){if(this.calculateFreqzs){if(i<0||i>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds. "+i+" is out of [0, "+this.filters.length-1+"]";if(!this.w){this.w=Float32Array(400);for(var t=0;t<this.w.length;t++)this.w[t]=Math.PI/this.w.length*t}this.freqzs[i]=h.mag2db(h.freqz([this.filters[i].b0,this.filters[i].b1,this.filters[i].b2],[this.filters[i].a0,this.filters[i].a1,this.filters[i].a2],this.w))}},this.process=function(i){for(var t=i,a=0;a<this.filters.length;a++)t=this.filters[a].process(t);return t},this.processStereo=function(i){for(var t=i,a=0;a<this.filters.length;a++)t=this.filters[a].processStereo(t);return t}},MultiDelay:z,SingleDelay:Y,Reverb:x})}},lt={};function ot(H){var h=lt[H];if(void 0!==h)return h.exports;var G=lt[H]={exports:{}};return ct[H](G,G.exports,ot),G.exports}(()=>{"use strict";const H=Symbol("Comlink.proxy"),h=Symbol("Comlink.endpoint"),G=Symbol("Comlink.releaseProxy"),Q=Symbol("Comlink.thrown"),tt=l=>"object"==typeof l&&null!==l||"function"==typeof l,U=new Map([["proxy",{canHandle:l=>tt(l)&&l[H],serialize(l){const{port1:n,port2:c}=new MessageChannel;return L(l,n),[c,[c]]},deserialize:l=>(l.start(),function V(l,n){return Z(l,[],n)}(l))}],["throw",{canHandle:l=>tt(l)&&Q in l,serialize({value:l}){let n;return n=l instanceof Error?{isError:!0,value:{message:l.message,name:l.name,stack:l.stack}}:{isError:!1,value:l},[n,[]]},deserialize(l){throw l.isError?Object.assign(new Error(l.value.message),l.value):l.value}}]]);function L(l,n=self){n.addEventListener("message",function c(u){if(!u||!u.data)return;const{id:m,type:v,path:f}=Object.assign({path:[]},u.data),S=(u.data.argumentList||[]).map(t);let T;try{const P=f.slice(0,-1).reduce((F,_)=>F[_],l),A=f.reduce((F,_)=>F[_],l);switch(v){case"GET":T=A;break;case"SET":P[f.slice(-1)[0]]=t(u.data.value),T=!0;break;case"APPLY":T=A.apply(P,S);break;case"CONSTRUCT":T=function x(l){return Object.assign(l,{[H]:!0})}(new A(...S));break;case"ENDPOINT":{const{port1:F,port2:_}=new MessageChannel;L(l,_),T=function Y(l,n){return z.set(l,n),l}(F,[F])}break;case"RELEASE":T=void 0;break;default:return}}catch(P){T={value:P,[Q]:0}}Promise.resolve(T).catch(P=>({value:P,[Q]:0})).then(P=>{const[A,F]=i(P);n.postMessage(Object.assign(Object.assign({},A),{id:m}),F),"RELEASE"===v&&(n.removeEventListener("message",c),W(n))})}),n.start&&n.start()}function W(l){(function B(l){return"MessagePort"===l.constructor.name})(l)&&l.close()}function I(l){if(l)throw new Error("Proxy has been released and is not useable")}function Z(l,n=[],c=function(){}){let u=!1;const m=new Proxy(c,{get(v,f){if(I(u),f===G)return()=>a(l,{type:"RELEASE",path:n.map(S=>S.toString())}).then(()=>{W(l),u=!0});if("then"===f){if(0===n.length)return{then:()=>m};const S=a(l,{type:"GET",path:n.map(T=>T.toString())}).then(t);return S.then.bind(S)}return Z(l,[...n,f])},set(v,f,S){I(u);const[T,P]=i(S);return a(l,{type:"SET",path:[...n,f].map(A=>A.toString()),value:T},P).then(t)},apply(v,f,S){I(u);const T=n[n.length-1];if(T===h)return a(l,{type:"ENDPOINT"}).then(t);if("bind"===T)return Z(l,n.slice(0,-1));const[P,A]=nt(S);return a(l,{type:"APPLY",path:n.map(F=>F.toString()),argumentList:P},A).then(t)},construct(v,f){I(u);const[S,T]=nt(f);return a(l,{type:"CONSTRUCT",path:n.map(P=>P.toString()),argumentList:S},T).then(t)}});return m}function rt(l){return Array.prototype.concat.apply([],l)}function nt(l){const n=l.map(i);return[n.map(c=>c[0]),rt(n.map(c=>c[1]))]}const z=new WeakMap;function i(l){for(const[n,c]of U)if(c.canHandle(l)){const[u,m]=c.serialize(l);return[{type:"HANDLER",name:n,value:u},m]}return[{type:"RAW",value:l},z.get(l)||[]]}function t(l){switch(l.type){case"HANDLER":return U.get(l.name).deserialize(l.value);case"RAW":return l.value}}function a(l,n,c){return new Promise(u=>{const m=function s(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}();l.addEventListener("message",function v(f){!f.data||!f.data.id||f.data.id!==m||(l.removeEventListener("message",v),u(f.data))}),l.start&&l.start(),l.postMessage(Object.assign({id:m},n),c)})}var r=ot(2054);class p{static mikelsFrequency(n,c,u){let m=0;const f=p.calculatePeaks(n,2,n.length,0);f.sort((_,C)=>n[C]-n[_]);let P=0,A=0;const F=c/u;for(let _=0;_<5;_++){const C=f[_];let X=0;for(let st=0;st<10;st++){const ut=C+st*C,ft=ut+2;let ht=-1;for(let it=ut-2;it<=ft;it++)it<n.length&&n[it]>ht&&(ht=n[it]);X+=ht}X>P&&(P=X,A=C)}return m=A*F,m}static calculatePeaks(n,c,u,m){let v=0;if(m>0)for(let S=0;S<u;S++)n[S]>v&&(v=n[S]);v*=m;const f=[];if(u>=c)for(let S=c;S<u-c;S++){let T=!0;if(n[S]>=v){for(let P=0;P<c;P++)if(n[S]<n[S-P]||n[S]<n[S+P]){T=!1;break}}else T=!1;T&&f.push(S)}return f}}const g=1.05946309436,M=["D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D","E","F","G","A","B","C","C","D"],O={Bb:233.08,B:246.94,C:261.63,D:293.66,Eb:311.13,F:349.23,G:392};var q=(()=>{return(l=q||(q={}))[l.FLUTE=0]="FLUTE",l[l.WHISTLE=1]="WHISTLE",q;var l})();class b{constructor(n="D",c="major"){this.fundamentalFrequency=O[n],this.pitchModel=q.FLUTE,this.knownFrequencies=new Array(33),this.midiNotes=new Array(87),this.makeScale(c),this.makeMidiNotes()}makeScale(n){const c=[1,2,4,5];if("major"==n){this.knownFrequencies[0]=this.pitchModel==q.FLUTE?this.fundamentalFrequency/Math.pow(g,12):this.fundamentalFrequency;for(let u=1;u<this.knownFrequencies.length;u++)this.knownFrequencies[u]=b.isWholeToneInterval(u,c)?1.1224620483108665*this.knownFrequencies[u-1]:this.knownFrequencies[u-1]*g}}static isWholeToneInterval(n,c){return n%=8,c.some(u=>u==n)}makeMidiNotes(){this.midiNotes[0]=27.5;for(let n=1;n<this.midiNotes.length;n++)this.midiNotes[n]=this.midiNotes[n-1]*g}spellFrequency(n){let c=0,u=Number.MAX_VALUE;if(n<this.knownFrequencies[0]||n>this.knownFrequencies.slice(-1)[0])return"Z";for(let m=0;m<this.knownFrequencies.length;m++){const v=Math.abs(n-this.knownFrequencies[m]);v<u&&(c=m,u=v)}return M[c]}spellFrequencyAsMidi(n){let c=0,u=Number.MAX_VALUE;if(n<this.midiNotes[0]||n>this.midiNotes.slice(-1)[0])return"Z";for(let m=0;m<this.midiNotes.length;m++){const v=Math.abs(n-this.midiNotes[m]);v<u&&(c=m,u=v)}return c+=21,c.toString()}}class K{constructor(n){this.inputSampleRate=void 0!==n.inputSampleRate?n.inputSampleRate:22050,this.sampleTime=void 0!==n.sampleTime?n.sampleTime:12,this.blankTime=void 0!==n.blankTime?n.blankTime:2,this.fundamental=void 0!==n.fundamental?n.fundamental:"D",this.enableSampleRateConversion=void 0!==n.enableSampleRateConversion&&n.enableSampleRateConversion,this.onProgress=void 0!==n.onProgress?n.onProgress:()=>{},this.outputSampleRate=this.enableSampleRateConversion?22050:this.inputSampleRate,this.numInputSamples=this.inputSampleRate*(this.blankTime+this.sampleTime),this.numOutputSamples=this.outputSampleRate*(this.blankTime+this.sampleTime),this.frameSize=void 0!==n.frameSize?n.frameSize:this.calcFrameSize(this.outputSampleRate),this.hopSize=.25*this.frameSize,this.windowFunction=new r.WindowFunction(r.DSP.HANN),this.powerSpectrum=new r.FFT(this.frameSize,this.outputSampleRate)}transcribe(n,c=!1){this.signal=this.enableSampleRateConversion?this.convertSampleRate(n):n;const u=new b(this.fundamental),m=Math.floor((this.outputSampleRate*this.sampleTime-this.frameSize)/this.hopSize)+1,v=[];let f="";const S=this.blankTime*this.outputSampleRate;for(let P=0;P<m;P++){if(this.interrupted)return"";const A=S+this.hopSize*P;this.progress=P/m,this.onProgress(this.progress);const F=this.signal.slice(A,A+this.frameSize);if(F.length!=this.frameSize)continue;this.windowFunction.process(F);const _=this.powerSpectrum.forward(F),C=p.mikelsFrequency(_,this.outputSampleRate,this.frameSize),X=c?u.spellFrequencyAsMidi(C):u.spellFrequency(C);X!=f&&(f=X,v.push({spelling:X,frequency:C,onset:A/this.outputSampleRate}))}return this.postProcess(v,c)}convertSampleRate(n){const c=new Float32Array(this.numOutputSamples);let u=0;for(let m=0;m<c.length;m++){const v=u;u=Math.floor((m+1)*this.inputSampleRate/this.outputSampleRate);let f=0;for(let S=v;S<u;S++)f+=n[S];c[m]=f/(u-v)}return c}postProcess(n,c){let u="";for(let f=0;f<n.length-1;f++)n[f].duration=n[f+1].onset-n[f].onset,n[f].duration<0&&console.log(n[f+1].onset,n[f].onset);n.slice(-1)[0].duration=this.blankTime+this.sampleTime-n.slice(-1)[0].onset;const m=new Array(n.length);for(let f=0;f<n.length;f++)m[f]=n[f].duration;const v=class o{static calculatePeak(n,c,u){const m=[];for(const v of n){let f=!1;for(let S=0;S<m.length;S++){const T=m[S],P=T.value*(1+c);if(v>=T.value*(1-c)&&v<=P){f=!0,T.count+=2,T.value=(T.value*(T.count-1)+v)/T.count,m[S]=T;break}}f||m.push({value:v,count:1})}m.sort((v,f)=>f.count-v.count);for(const v of m){const f=v.value;if(f>=u)return f}return u}}.calculatePeak(m,.33,.1);for(const f of n){if("Z"==f.spelling)continue;f.qq=Math.round(f.duration/v);let S=f.spelling;c&&(S+=","),S=S.repeat(f.qq),u+=S}return u}calcFrameSize(n){const c=n/10,u=this.prevPow2(c),m=2*u;return m-c<u-c?m:u}prevPow2(n){return Math.pow(2,Math.floor(Math.log(n)/Math.log(2)))}}L(new class j{initialize(n){this.transcriber=new K(n),this.resetSignal()}resetSignal(){this.signal=[],this.currNumSamples=0}mergeSignal(){let n=this.transcriber.numInputSamples,c=new Float32Array(n),u=0;for(let m of this.signal){let v=u+m.length;c.set(v<=n?m:m.subarray(0,n-u),u),u=v}return c}transcribe(n,c=!1){let u=n||this.mergeSignal(),m=this.transcriber.transcribe(u,c);return console.log(`Worker: transcription: ${m}`),{transcription:m,sampleRate:this.transcriber.outputSampleRate,numSamples:this.transcriber.numOutputSamples}}pushSignal(n){this.signal.push(n),this.currNumSamples+=n.length;let c=Number.MIN_VALUE;for(let u of n)u>c&&(c=u);return{amplitude:c,timeRecorded:this.currNumSamples/this.transcriber.inputSampleRate,isBufferFull:this.currNumSamples>=this.transcriber.numInputSamples}}})})()})();