"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _get=function(_x11,_x12,_x13){for(var _again=!0;_again;){var object=_x11,property=_x12,receiver=_x13;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x11=parent,_x12=property,_x13=receiver,_again=!0,desc=parent=void 0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();(function(){var $$BlobUtils$es6lib$$_BlobUtils=function(){function $$BlobUtils$es6lib$$_BlobUtils(){_classCallCheck(this,$$BlobUtils$es6lib$$_BlobUtils)}return _createClass($$BlobUtils$es6lib$$_BlobUtils,[{key:"dataURLToBlob",value:function(dataURL){var BASE64_MARKER=";base64,";if(dataURL.indexOf(BASE64_MARKER)==-1){for(var parts=dataURL.split(","),contentType=parts[0].split(":")[1],raw=parts[1],numPercent=(raw.match(/%/g)||[]).length,_length=raw.length-2*numPercent,uInt8Array=new Uint8Array(_length),i=0,j=0;i<raw.length;j++)if("%"===raw[i]){var code=raw.substr(i+1,2);uInt8Array[j]=parseInt(code,16),i+=3}else uInt8Array[j]=raw.charCodeAt(i),i++;return new Blob([uInt8Array],{type:contentType})}for(var parts=dataURL.split(BASE64_MARKER),contentType=parts[0].split(":")[1],raw=window.atob(parts[1]),rawLength=raw.length,uInt8Array=new Uint8Array(rawLength),i=0;i<rawLength;++i)uInt8Array[i]=raw.charCodeAt(i);return new Blob([uInt8Array],{type:contentType})}}]),$$BlobUtils$es6lib$$_BlobUtils}(),$$BlobUtils$es6lib$$BlobUtils=new $$BlobUtils$es6lib$$_BlobUtils,$$BlobUtils$es6lib$$default=$$BlobUtils$es6lib$$BlobUtils,$$CacheUtils$es6lib$$_CacheUtils=function $$CacheUtils$es6lib$$_CacheUtils(){_classCallCheck(this,$$CacheUtils$es6lib$$_CacheUtils),this.europeana={},this.keywordSearch={},this.notesSearch={},this.tune={}},$$CacheUtils$es6lib$$CacheUtils=new $$CacheUtils$es6lib$$_CacheUtils,$$CacheUtils$es6lib$$default=$$CacheUtils$es6lib$$CacheUtils,$$DateUtils$es6lib$$_DateUtils=function(){function $$DateUtils$es6lib$$_DateUtils(){_classCallCheck(this,$$DateUtils$es6lib$$_DateUtils)}return _createClass($$DateUtils$es6lib$$_DateUtils,[{key:"format",value:function(timestamp){var year=timestamp.getFullYear(),month=timestamp.getMonth()+1,day=timestamp.getDate(),hours=timestamp.getHours(),minutes=timestamp.getMinutes(),seconds=timestamp.getSeconds();return year+"-"+month+"-"+day+"%20"+hours+"%3A"+minutes+"%3A"+seconds}}]),$$DateUtils$es6lib$$_DateUtils}(),$$DateUtils$es6lib$$DateUtils=new $$DateUtils$es6lib$$_DateUtils,$$DateUtils$es6lib$$default=$$DateUtils$es6lib$$DateUtils,$$LocalStorageUtils$es6lib$$_LocalStorageUtils=function(){function $$LocalStorageUtils$es6lib$$_LocalStorageUtils(){_classCallCheck(this,$$LocalStorageUtils$es6lib$$_LocalStorageUtils)}return _createClass($$LocalStorageUtils$es6lib$$_LocalStorageUtils,[{key:"getItem",value:function(key){var value=localStorage.getItem(key);return value&&JSON.parse(value)}},{key:"setItem",value:function(key,value){localStorage.setItem(key,JSON.stringify(value))}}]),$$LocalStorageUtils$es6lib$$_LocalStorageUtils}(),$$LocalStorageUtils$es6lib$$LocalStorageUtils=new $$LocalStorageUtils$es6lib$$_LocalStorageUtils,$$LocalStorageUtils$es6lib$$default=$$LocalStorageUtils$es6lib$$LocalStorageUtils,$$TranscriberUtils$es6lib$$_TranscriberUtils=function(){function $$TranscriberUtils$es6lib$$_TranscriberUtils(){_classCallCheck(this,$$TranscriberUtils$es6lib$$_TranscriberUtils)}return _createClass($$TranscriberUtils$es6lib$$_TranscriberUtils,[{key:"calcFrameSize",value:function(sampleRate){var idealFrameSize=sampleRate/10,prev=this.prevPow2(idealFrameSize),next=2*prev;return next-idealFrameSize<prev-idealFrameSize?next:prev}},{key:"prevPow2",value:function(v){return Math.pow(2,Math.floor(Math.log(v)/Math.log(2)))}}]),$$TranscriberUtils$es6lib$$_TranscriberUtils}(),$$TranscriberUtils$es6lib$$TranscriberUtils=new $$TranscriberUtils$es6lib$$_TranscriberUtils,$$TranscriberUtils$es6lib$$default=$$TranscriberUtils$es6lib$$TranscriberUtils,$$ViewUtils$es6lib$$_ViewUtils=function(){function $$ViewUtils$es6lib$$_ViewUtils(){_classCallCheck(this,$$ViewUtils$es6lib$$_ViewUtils),this.smallScreen=600,this.mediumScreen=992,this.largeScreen=1200}return _createClass($$ViewUtils$es6lib$$_ViewUtils,[{key:"showSideNav",value:function(){$(".hamburger-button").sideNav("show")}},{key:"goBack",value:function(){1==history.length?location.replace("/#!/record"):history.back()}},{key:"doubleEncode",value:function(component){return encodeURIComponent(encodeURIComponent(component))}},{key:"initDropdown",value:function(){$(".dropdown-button").dropdown({constrain_width:!1})}},{key:"initTooltips",value:function(){$(".tooltipped").tooltip({position:"bottom",delay:50})}},{key:"isSmall",get:function(){return $(window).width()<=this.smallScreen}},{key:"isMedium",get:function(){return $(window).width()>this.smallScreen&&$(window).width()<=this.mediumScreen}},{key:"isLarge",get:function(){return $(window).width()>this.mediumScreen}},{key:"isMediumOrUp",get:function(){return $(window).width()>this.smallScreen}},{key:"isMediumOrDown",get:function(){return $(window).width()<=this.mediumScreen}},{key:"isLandscape",get:function(){var windowWidth=$(window).width(),windowHeight=$(window).height();return windowWidth<=this.mediumScreen?windowWidth>windowHeight:windowWidth-240>windowHeight}},{key:"isPortrait",get:function(){return!this.isLandscape}},{key:"navbarHeight",get:function(){return this.isMediumOrDown?56:64}}]),$$ViewUtils$es6lib$$_ViewUtils}(),$$ViewUtils$es6lib$$ViewUtils=new $$ViewUtils$es6lib$$_ViewUtils,$$ViewUtils$es6lib$$default=$$ViewUtils$es6lib$$ViewUtils,$$utils$Utils$es6lib$$_Utils=function(){function $$utils$Utils$es6lib$$_Utils(){_classCallCheck(this,$$utils$Utils$es6lib$$_Utils),this.blob=$$BlobUtils$es6lib$$default,this.cache=$$CacheUtils$es6lib$$default,this.date=$$DateUtils$es6lib$$default,this.localStorage=$$LocalStorageUtils$es6lib$$default,this.transcriber=$$TranscriberUtils$es6lib$$default,this.view=$$ViewUtils$es6lib$$default,this.tuneCache=null,this.europeanaCache=null}return _createClass($$utils$Utils$es6lib$$_Utils,[{key:"makeArray",value:function(){for(var start=arguments.length<=0||void 0===arguments[0]?0:arguments[0],end=arguments.length<=1||void 0===arguments[1]?10:arguments[1],step=arguments.length<=2||void 0===arguments[2]?1:arguments[2],array=[],i=start;i<=end;i+=step)array.push(i);return array}},{key:"defineProperty",value:function(className){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _len=arguments.length,names=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)names[_key-1]=arguments[_key];for(var _step,_iterator=names[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)name=_step.value,Object.defineProperty(className,name,{get:function(){return this["_"+name]},set:function(value){this["_"+name]=value}})}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"createEnum",value:function(names){for(var enumClass={},i=0;i<names.length;i++)enumClass[names[i]]=i+1;return enumClass}},{key:"createPolyfills",value:function(){"undefined"!=typeof navigator&&("undefined"==typeof navigator.mediaDevices&&(navigator.mediaDevices={}),"undefined"==typeof navigator.mediaDevices.getUserMedia&&!function(){var getUserMediaOld=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;"undefined"!=typeof getUserMediaOld&&(navigator.mediaDevices.getUserMedia=function(constraints){var callbacks={};return getUserMediaOld(constraints,function(stream){return callbacks.successCallback(stream)},function(err){return callbacks.errorCallback(err)}),{then:function(successCallback){return callbacks.successCallback=successCallback},"catch":function(errorCallback){return callbacks.errorCallback=errorCallback}}})}()),"undefined"!=typeof window&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return window.setTimeout(callback,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(id){window.clearTimeout(id)}),"undefined"!=typeof AudioBuffer&&(AudioBuffer.prototype.copyToChannel=AudioBuffer.prototype.copyToChannel||function(source,channelNumber,startInChannel){this.getChannelData(channelNumber).set(source,startInChannel)}),"undefined"!=typeof Float32Array&&(Float32Array.prototype.slice=Float32Array.prototype.slice||function(begin,end){begin="undefined"!=typeof begin?begin:0,end="undefined"!=typeof end?end:this.length;var newArray=this.buffer.slice(4*begin,4*end);return new Float32Array(newArray)})}},{key:"joinSet",value:function(set){var s="",i=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=set[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var item=_step2.value;0!=i&&(s+=","),s+=item,i++}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return s}}]),$$utils$Utils$es6lib$$_Utils}();Array.prototype.last=Array.prototype.last||function(){return this[this.length-1]};var $$utils$Utils$es6lib$$Utils=new $$utils$Utils$es6lib$$_Utils;$$utils$Utils$es6lib$$Utils.createPolyfills();var $$utils$Utils$es6lib$$default=$$utils$Utils$es6lib$$Utils,$$pages$_navbar$NavbarController$es6lib$$NavbarController=function $$pages$_navbar$NavbarController$es6lib$$NavbarController(){_classCallCheck(this,$$pages$_navbar$NavbarController$es6lib$$NavbarController),this.utils=$$utils$Utils$es6lib$$default},$$pages$_navbar$NavbarController$es6lib$$default=$$pages$_navbar$NavbarController$es6lib$$NavbarController,$$pages$_preloader$PreloaderController$es6lib$$PreloaderController=function $$pages$_preloader$PreloaderController$es6lib$$PreloaderController(){_classCallCheck(this,$$pages$_preloader$PreloaderController$es6lib$$PreloaderController)},$$pages$_preloader$PreloaderController$es6lib$$default=$$pages$_preloader$PreloaderController$es6lib$$PreloaderController,$$Directive$es6lib$$Directive=function $$Directive$es6lib$$Directive(app){_classCallCheck(this,$$Directive$es6lib$$Directive),app.directive("tpNavbar",function(){return{scope:{title:"@",goBack:"@"},controller:$$pages$_navbar$NavbarController$es6lib$$default,controllerAs:"navbar",templateUrl:"scripts/pages/_navbar/navbar.html"}}),app.directive("tpPreloader",function(){return{scope:{size:"@"},controller:$$pages$_preloader$PreloaderController$es6lib$$default,controllerAs:"preloader",templateUrl:"scripts/pages/_preloader/preloader.html"}})},$$Directive$es6lib$$default=$$Directive$es6lib$$Directive,$$$$$$ControllerBase$es6lib$$ControllerBase=function(){function $$$$$$ControllerBase$es6lib$$ControllerBase($scope){_classCallCheck(this,$$$$$$ControllerBase$es6lib$$ControllerBase),this.$scope=$scope}return _createClass($$$$$$ControllerBase$es6lib$$ControllerBase,[{key:"apply",value:function(func){var that=arguments.length<=1||void 0===arguments[1]?this:arguments[1],wrap=function(){var args=arguments;return this.$scope.$apply(function(){return func.apply(that,args)})};return wrap.bind(this)}},{key:"applyFailed",value:function(func){return this.$scope.$apply.bind(this.$scope,func)}},{key:"_calcPages",value:function(results,pageSize){var pages=new Array(Math.ceil(results.length/pageSize));if(pages.length<=0)return pages;for(var i=0;i<pages.length;i++)pages[i]={startIndex:i*pageSize,start:i*pageSize+1,end:(i+1)*pageSize};return pages[pages.length-1].end=results.length,pages}}]),$$$$$$ControllerBase$es6lib$$ControllerBase}(),$$$$$$ControllerBase$es6lib$$default=$$$$$$ControllerBase$es6lib$$ControllerBase,$$models$Fundamentals$es6lib$$default=["Bb","B","C","D","Eb","F","G"],$$models$MidiInstruments$es6lib$$default=["Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavi","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)","Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","SynthStrings 1","SynthStrings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","SynthBrass 1","SynthBrass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)","Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bag pipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot"],$$models$TimeSignatures$es6lib$$default={all:"All",reels:"C, C|,  4/4,  2/4,  2/2, 4/2 - Reels, hornpipes, polkas etc.",jigs:"6/8, 12/8 - Jigs, slides etc.",slip_jigs:"9/8 - Slip Jigs, hop jigs",waltzes:"3/4 - Waltzes, mazurkas, polskas, minuets etc.",unusual_jigs:"3/8 - Unusual Jigs &amp; Waltzes",unusual_hornpipes:"3/2, 6/4 - Unusual English hornpipes and country dances"},$$models$TranscriberFrameSizes$es6lib$$default=["auto","2048","4096"],$$$$$$models$Tunebook$es6lib$$Tunebook=function(){function $$$$$$models$Tunebook$es6lib$$Tunebook(rawTunebook){_classCallCheck(this,$$$$$$models$Tunebook$es6lib$$Tunebook),this.id=rawTunebook.id,this.fullName=rawTunebook.fullName,this.shortName=rawTunebook.shortName,this.url=rawTunebook.url,this.extra=rawTunebook.extra,this.count=rawTunebook.count}return _createClass($$$$$$models$Tunebook$es6lib$$Tunebook,[{key:"logoUrl",get:function(){return"http://tunepal.org/test/tunepal/source_icons/s"+this.id+".png"}}]),$$$$$$models$Tunebook$es6lib$$Tunebook}(),$$$$$$models$Tunebook$es6lib$$default=$$$$$$models$Tunebook$es6lib$$Tunebook,$$models$TunebookManager$es6lib$$_TunebookManager=function(){function $$models$TunebookManager$es6lib$$_TunebookManager(){_classCallCheck(this,$$models$TunebookManager$es6lib$$_TunebookManager),this.DefaultTunebooks=$$models$TunebookManager$es6lib$$DefaultTunebooks,this.DefaultSelectedIds=$$models$TunebookManager$es6lib$$DefaultSelectedIds;var rawTunebooks=$$utils$Utils$es6lib$$default.localStorage.getItem("tunebooks");null===rawTunebooks&&(rawTunebooks=this.DefaultTunebooks,$$utils$Utils$es6lib$$default.localStorage.setItem("tunebooks",rawTunebooks)),this._tunebooks=this._initTunebooks(rawTunebooks),this._selectedIds=$$utils$Utils$es6lib$$default.localStorage.getItem("tunebookSelectedIds"),null===this._selectedIds&&(this._selectedIds=this.DefaultSelectedIds,$$utils$Utils$es6lib$$default.localStorage.setItem("tunebookSelectedIds",this._selectedIds)),this._selectedIds=new Set(this._selectedIds)}return _createClass($$models$TunebookManager$es6lib$$_TunebookManager,[{key:"_initTunebooks",value:function(rawTunebooks){var tunebooks=[],_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=rawTunebooks[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var rawTunebook=_step3.value;tunebooks[rawTunebook.id]=new $$$$$$models$Tunebook$es6lib$$default(rawTunebook)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}return tunebooks[0]||(tunebooks[0]=new $$$$$$models$Tunebook$es6lib$$default({id:0,fullName:"All",shortName:"All"})),tunebooks}},{key:"updateTunebooks",value:function($http){var _this=this;return new Promise(function(resolve,reject){var url=$$$$$$Config$es6lib$$default.ApiDomain+"/api/Sources";$http.get(url).success(function(tunebooks){_this._tunebooks=_this._initTunebooks(tunebooks),$$utils$Utils$es6lib$$default.localStorage.setItem("tunebooks",tunebooks),resolve()})})}},{key:"getById",value:function(id){return this._tunebooks[id]}},{key:"isSelected",value:function(id){return this._selectedIds.has(0)||this._selectedIds.has(parseInt(id))}},{key:"select",value:function(id){id=parseInt(id),0===id?this._selectedIds=new Set([0]):(this._selectedIds.add(id),this._selectedIds.size===this._tunebooks.length-1&&(this._selectedIds=new Set([0]))),$$utils$Utils$es6lib$$default.localStorage.setItem("tunebookSelectedIds",this._selectedIds)}},{key:"deselect",value:function(id){if(id=parseInt(id),0===id)this._selectedIds=new Set;else if(this._selectedIds.has(0)){this._selectedIds=new Set;var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this._tunebooks[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var tunebook=_step4.value;tunebook.id!=id&&0!=tunebook.id&&this._selectedIds.add(tunebook.id)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}}else this._selectedIds["delete"](id);$$utils$Utils$es6lib$$default.localStorage.setItem("tunebookSelectedIds",this._selectedIds)}},{key:"toggle",value:function(id){id=parseInt(id),this.isSelected(id)?this.deselect(id):this.select(id)}},{key:"selectedIds",get:function(){return this._selectedIds}},{key:"selectedShortNames",get:function(){if(0===this._selectedIds.size)return"None";var names="",i=0,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=this._selectedIds[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var id=_step5.value;0!=i&&(names+=", "),names+=this._tunebooks[id].shortName,i++}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}return names}},{key:"all",get:function(){return this._tunebooks}}]),$$models$TunebookManager$es6lib$$_TunebookManager}(),$$models$TunebookManager$es6lib$$DefaultSelectedIds=[0],$$models$TunebookManager$es6lib$$DefaultTunebooks=[{id:0,fullName:"All",shortName:"All"},{id:1,fullName:"thesession.org",shortName:"thesession.org",url:"http://thesession.org"},{id:2,fullName:"Henrik Norbeck",shortName:"Norbeck",url:"http://www.norbeck.nu/abc/"},{id:3,fullName:"O'Neill's 1001",shortName:"O'Neill's",url:"http://trillian.mit.edu/~jc/music/book/oneills/"},{id:4,fullName:"Ceol Rince na hÉireann 1",shortName:"CRÉ1",url:"http://www.nigelgatherer.com/books/CRE/cre1.html",extra:"Transcribed by Bill Black"},{id:5,fullName:"Ceol Rince na hÉireann 2",shortName:"CRÉ2",url:"http://www.nigelgatherer.com/books/CRE/cre2.html",extra:"Transcribed by Bill Black"},{id:6,fullName:"Ceol Rince na hÉireann 3",shortName:"CRÉ3",url:"http://www.nigelgatherer.com/books/CRE/cre3.html",extra:"Transcribed by Bill Black"},{id:7,fullName:"Ceol Rince na hÉireann 4",shortName:"CRÉ4",url:"http://www.nigelgatherer.com/books/CRE/cre4.html",extra:"Transcribed by Bill Black"},{id:8,fullName:"Johnny O'Leary",shortName:"O'Leary",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:9,fullName:"Nigel Gatherer",shortName:"Nigel Gatherer",url:"http://www.nigelgatherer.com/tunes/abc.html"},{id:10,fullName:"The Microphone Rambles",shortName:"The Microphone Rambles",url:"http://archive.org/details/TheMicrophonesRambles"},{id:11,fullName:"Welsh Music (John Tose)",shortName:"Welsh Music",url:"http://johntose.blogspot.ie/"},{id:12,fullName:"Scottish Flute Music (Jack Campin)",shortName:"Scottish Flute Music",url:"http://www.campin.me.uk/Flute/Webrelease/Flute/Flute.htm"},{id:13,fullName:"Company of Fife and Drum",shortName:"Company of Fife and Drum",url:"http://companyoffifeanddrum.org/"},{id:14,fullName:"Nottingham Music Database",shortName:"Nottingham",url:"http://abc.sourceforge.net/NMD/"},{id:15,fullName:"Aird's Airs (Jack Campin)",shortName:"Aird's Airs",url:"http://www.campin.me.uk/"},{id:16,fullName:"Ceol Rince na hÉireann 5",shortName:"CRÉ5",url:"http://www.nigelgatherer.com/books/CRE/cre5.html",extra:"Transcribed by Bill Black"},{id:17,fullName:"The Bill Black Irish Tune Collection v.1",shortName:"Bill Black Irish Tune Collection",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:18,fullName:"The Turoe Stone - Collection of tunes by Vincent Broderick",shortName:"Turroe Stone",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:19,fullName:"Harding's Original Collection of Jigs and Reels",shortName:"Harding's",url:"http://www.capeirish.com/webabc/collections/hoc/home.html",extra:"Transcribed by Bill Black"},{id:20,fullName:"CCE session tunes",shortName:"Comhaltas",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:21,fullName:"The Leitrim Fiddler Volume 1 - Joe Liddy",shortName:"Leitrim Fiddler Vol 1",url:"http://www.capeirish.com/webabc/collections/liddy1/liddy1-index.html",extra:"Transcribed by Bill Black"},{id:22,fullName:"The Leitrim Fiddler Volume 2 - Joe Liddy",shortName:"Leitrim Fiddler - Vol 2",url:" http://www.capeirish.com/webabc/collections/liddy2/liddy2-index.html",extra:"Transcribed by Bill Black"},{id:23,fullName:"O'Farrell's Pocket Companion for the Irish or Union Pipes - Vol 1",shortName:"O'Farrell's - Vol 1",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:24,fullName:"O'Farrell's Pocket Companion for the Irish or Union Pipes - Vol 2",shortName:"O'Farrell's - Vol 2",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:25,fullName:"O'Farrell's Pocket Companion for the Irish or Union Pipes - Vol 3",shortName:"O'Farrell's - Vol 3",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:26,fullName:"O'Farrell's Pocket Companion for the Irish or Union Pipes - Vol 4",shortName:"O'Farrell's - Vol 4",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:27,fullName:"O'Farrell's Collection of National Irish Music for the Union Pipes",shortName:"O'Farrell's Collection",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:28,fullName:"The Music of Brendan Tonra",shortName:"Brendan Tonra",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:29,fullName:"Luke O'Malley's Collection of Irish Music Volume 1",shortName:"Luke O'Malley",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:30,fullName:"Bill Black's Miscellaneous tunes",shortName:"Black's Miscellaneous",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Transcribed by Bill Black"},{id:31,fullName:"Mostly Gems",shortName:"Mostly Gems",url:"http://www.capeirish.com/webabc/collections/coll-index.html",extra:"Composed by Bill Black"},{id:32,fullName:"Paul Hardy's Tunebooks",shortName:"Paul Hardy",url:"http://www.pghardy.net/concertina/tunebooks/index.html",extra:"Traditional Celtic and English Tunes from the British Isles"},{id:33,fullName:"William Clarke of Feltwell Tunebook",shortName:"William Clarke",url:"http://www.pghardy.net/concertina/tunebooks/#williamclarke",extra:"Transcribed by Paul Hardy"},{id:34,fullName:'Bulmer and Sharpely "Music from Ireland" (1974)',shortName:"Bulmer & Sharpely",url:"http://www.capeirish.com/webabc/collections/bsmi/bsmi_project_home.html",extra:"Transcribed by Bill Black"}],$$models$TunebookManager$es6lib$$TunebookManager=new $$models$TunebookManager$es6lib$$_TunebookManager,$$models$TunebookManager$es6lib$$default=$$models$TunebookManager$es6lib$$TunebookManager,$$$$$$Config$es6lib$$_Config=function(){function $$$$$$Config$es6lib$$_Config(){_classCallCheck(this,$$$$$$Config$es6lib$$_Config),this.Fundamentals=$$models$Fundamentals$es6lib$$default,this.MidiInstruments=$$models$MidiInstruments$es6lib$$default,this.TimeSignatures=$$models$TimeSignatures$es6lib$$default,this.TranscriberFrameSizes=$$models$TranscriberFrameSizes$es6lib$$default,this.tunebooks=$$models$TunebookManager$es6lib$$default,this.CountdownTime=$$utils$Utils$es6lib$$default.makeArray(0,10),this.PlaybackSpeed=$$utils$Utils$es6lib$$default.makeArray(1,10),this.Transpose=$$utils$Utils$es6lib$$default.makeArray(-12,12),this.ApiDomain="https://cors-anywhere.herokuapp.com/https://tunepal.org/tunepal2",this.EuropeanaApiDomain="https://www.europeana.eu/api/v2",this.EuropeanaPortalDomain="https://www.europeana.eu/portal/search.html",this.EuropeanaApiKey="QNbCgzoWb",this.Properties=$$$$$$Config$es6lib$$Properties,this.audioContext=new window.AudioContext,this.isTesting=!1,this._createProperties()}return _createClass($$$$$$Config$es6lib$$_Config,[{key:"_createProperties",value:function(){var _this2=this;this._settings=[],this.defaults=[];var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_loop=function(){var property=_step6.value;_this2.defaults[property.name]=property["default"];var storedValue=$$utils$Utils$es6lib$$default.localStorage.getItem(property.name);null==storedValue&&(storedValue=property["default"],$$utils$Utils$es6lib$$default.localStorage.setItem(property.name,storedValue)),_this2._settings[property.name]=storedValue,Object.defineProperty(_this2,property.name,{get:function(){return _this2._settings[property.name]},set:function(value){if(null!=property.validate){var result=property.validate(value);if(!result.success)return;value=result.value}_this2._settings[property.name]=value,$$utils$Utils$es6lib$$default.localStorage.setItem(property.name,value)}})},_iterator6=this.Properties[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0)_loop()}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}}}]),$$$$$$Config$es6lib$$_Config}(),$$$$$$Config$es6lib$$Properties=[{name:"blankTime","default":2},{name:"chords","default":$$models$MidiInstruments$es6lib$$default[0]},{name:"countdownTime","default":3},{name:"enableSampleRateConversion","default":!1},{name:"fundamental","default":"D"},{name:"melody","default":$$models$MidiInstruments$es6lib$$default[0]},{name:"playbackSpeed","default":5},{name:"sampleTime","default":12},{name:"timeSigs","default":"all"},{name:"transcriberFrameSize","default":$$models$TranscriberFrameSizes$es6lib$$default[0]},{name:"transpose","default":0}],$$$$$$Config$es6lib$$Config=new $$$$$$Config$es6lib$$_Config,$$$$$$Config$es6lib$$default=$$$$$$Config$es6lib$$Config,$$$$$$models$Tune$es6lib$$Tune=function(){function $$$$$$models$Tune$es6lib$$Tune(rawTune){if(_classCallCheck(this,$$$$$$models$Tune$es6lib$$Tune),rawTune.title){var tmp=rawTune.title.replace(/, The$/,"");this.title=tmp.length===rawTune.title.length?tmp:"The "+tmp,this.title=$$$$$$models$Tune$es6lib$$Tune._convertSpecialChars(this.title),this.titleEncoded=encodeURIComponent(this.title)}if(rawTune.altTitle){var tmp=rawTune.altTitle.replace(/, The$/,"");this.altTitle=tmp.length===rawTune.altTitle.length?tmp:"The "+tmp,this.altTitle=$$$$$$models$Tune$es6lib$$Tune._convertSpecialChars(this.altTitle)}this.x=rawTune.x,this.id=rawTune.id,this.tunepalId=rawTune.tunepalid,this.tunepalIdEncoded=encodeURIComponent(this.tunepalId),this.tunepalIdDoubleEncoded=encodeURIComponent(this.tunepalIdEncoded),this.tunebook=$$models$TunebookManager$es6lib$$default.getById(rawTune.sourceId),this.tuneType=rawTune.tuneType,this.keySignature=rawTune.keySignature,this.confidence=rawTune.confidence,this.ed=rawTune.ed,this.notation=$$$$$$models$Tune$es6lib$$Tune._convertSpecialChars(rawTune.notation)}return _createClass($$$$$$models$Tune$es6lib$$Tune,[{key:"abcForPlayback",value:function(){var speed=$$$$$$Config$es6lib$$default.playbackSpeed,transpose=$$$$$$Config$es6lib$$default.transpose,lines=this.notation.split(/\r?\n/),abc=lines[0]+"\n",midiNoteLength=Math.floor(30+speed/9*300);abc+="%%MIDI transpose "+transpose+"\n",abc+="Q:1/4 = "+midiNoteLength+"\n";for(var i=1;i<lines.length;i++)abc+=lines[i]+"\n";return abc}}],[{key:"_convertSpecialChars",value:function(text){if(!text)return text;var specialChars=[["À",/\{?(\\`A|&Agrave;|\\u00c0)\}?/g],["à",/\{?(\\`a|&agrave;|\\u00e0)\}?/g],["È",/\{?(\\`E|&Egrave;|\\u00c8)\}?/g],["è",/\{?(\\`e|&egrave;|\\u00e8)\}?/g],["Ì",/\{?(\\`I|&Igrave;|\\u00cc)\}?/g],["ì",/\{?(\\`i|&igrave;|\\u00ec)\}?/g],["Ò",/\{?(\\`O|&Ograve;|\\u00d2)\}?/g],["ò",/\{?(\\`o|&ograve;|\\u00f2)\}?/g],["Ù",/\{?(\\`U|&Ugrave;|\\u00d9)\}?/g],["ù",/\{?(\\`u|&ugrave;|\\u00f9)\}?/g],["Á",/\{?(\\'A|&Aacute;|\\u00c1)\}?/g],["á",/\{?(\\'a|&aacute;|\\u00e1)\}?/g],["É",/\{?(\\'E|&Eacute;|\\u00c9)\}?/g],["é",/\{?(\\'e|&eacute;|\\u00e9)\}?/g],["Í",/\{?(\\'I|&Iacute;|\\u00cd)\}?/g],["í",/\{?(\\'i|&iacute;|\\u00ed)\}?/g],["Ó",/\{?(\\'O|&Oacute;|\\u00d3)\}?/g],["ó",/\{?(\\'o|&oacute;|\\u00f3)\}?/g],["Ú",/\{?(\\'U|&Uacute;|\\u00da)\}?/g],["ú",/\{?(\\'u|&uacute;|\\u00fa)\}?/g],["Ý",/\{?(\\'Y|&Yacute;|\\u00dd)\}?/g],["ý",/\{?(\\'y|&yacute;|\\u00fd)\}?/g],["Â",/\{?(\\\^A|&Acirc;|\\u00c2)\}?/g],["â",/\{?(\\\^a|&acirc;|\\u00e2)\}?/g],["Ê",/\{?(\\\^E|&Ecirc;|\\u00ca)\}?/g],["ê",/\{?(\\\^e|&ecirc;|\\u00ea)\}?/g],["Î",/\{?(\\\^I|&Icirc;|\\u00ce)\}?/g],["î",/\{?(\\\^i|&icirc;|\\u00ee)\}?/g],["Ô",/\{?(\\\^O|&Ocirc;|\\u00d4)\}?/g],["ô",/\{?(\\\^o|&ocirc;|\\u00f4)\}?/g],["Û",/\{?(\\\^U|&Ucirc;|\\u00db)\}?/g],["û",/\{?(\\\^u|&ucirc;|\\u00fb)\}?/g],["Ŷ",/\{?(\\\^Y|&Ycirc;|\\u0176)\}?/g],["ŷ",/\{?(\\\^y|&ycirc;|\\u0177)\}?/g],["Ã",/\{?(\\~A|&Atilde;|\\u00c3)\}?/g],["ã",/\{?(\\~a|&atilde;|\\u00e3)\}?/g],["Ñ",/\{?(\\~N|&Ntilde;|\\u00d1)\}?/g],["ñ",/\{?(\\~n|&ntilde;|\\u00f1)\}?/g],["Õ",/\{?(\\~O|&Otilde;|\\u00d5)\}?/g],["õ",/\{?(\\~o|&otilde;|\\u00f5)\}?/g],["Ä",/\{?(\\"A|&Auml;|\\u00c4)\}?/g],["ä",/\{?(\\"a|&auml;|\\u00e4)\}?/g],["Ë",/\{?(\\"E|&Euml;|\\u00cb)\}?/g],["ë",/\{?(\\"e|&euml;|\\u00eb)\}?/g],["Ï",/\{?(\\"I|&Iuml;|\\u00cf)\}?/g],["ï",/\{?(\\"i|&iuml;|\\u00ef)\}?/g],["Ö",/\{?(\\"O|&Ouml;|\\u00d6)\}?/g],["ö",/\{?(\\"o|&ouml;|\\u00f6)\}?/g],["Ü",/\{?(\\"U|&Uuml;|\\u00dc)\}?/g],["ü",/\{?(\\"u|&uuml;|\\u00fc)\}?/g],["Ÿ",/\{?(\\"Y|&Yuml;|\\u0178)\}?/g],["ÿ",/\{?(\\"y|&yuml;|\\u00ff)\}?/g],["Ç",/\{?(\\cC|&Ccedil;|\\u00c7)\}?/g],["ç",/\{?(\\cc|&ccedil;|\\u00e7)\}?/g],["Å",/\{?(\\AA|&Aring;|\\u00c5)\}?/g],["å",/\{?(\\aa|&aring;|\\u00e5)\}?/g],["Ø",/\{?(\\\/O|&Oslash;|\\u00d8)\}?/g],["ø",/\{?(\\\/o|&oslash;|\\u00f8)\}?/g],["Ă",/\{?(\\uA|&Abreve;|\\u0102)\}?/g],["ă",/\{?(\\ua|&abreve;|\\u0103)\}?/g],["Ĕ",/\{?(\\uE|\\u0114)\}?/g],["ĕ",/\{?(\\ue|\\u0115)\}?/g],["Š",/\{?(\\vS|&Scaron;|\\u0160)\}?/g],["š",/\{?(\\vs|&scaron;|\\u0161)\}?/g],["Ž",/\{?(\\vZ|&Zcaron;|\\u017d)\}?/g],["ž",/\{?(\\vz|&zcaron;|\\u017e)\}?/g],["Ő",/\{?(\\HO|\\u0150)\}?/g],["ő",/\{?(\\Ho|\\u0151)\}?/g],["Ű",/\{?(\\HU|\\u0170)\}?/g],["ű",/\{?(\\Hu|\\u0171)\}?/g],["Æ",/\{?(\\AE|&AElig;|\\u00c6)\}?/g],["æ",/\{?(\\ae|&aelig;|\\u00e6)\}?/g],["Œ",/\{?(\\OE|&OElig;|\\u0152)\}?/g],["œ",/\{?(\\oe|&oelig;|\\u0153)\}?/g],["ß",/\{?(\\ss|&szlig;|\\u00df)\}?/g],["Ð",/\{?(\\DH|&ETH;|\\u00d0)\}?/g],["ð",/\{?(\\dh|&eth;|\\u00f0)\}?/g],["Þ",/\{?(\\TH|&THORN;|\\u00de)\}?/g],["þ",/\{?(\\th|&thorn;|\\u00fe)\}?/g]],_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;
try{for(var _step7,_iterator7=specialChars[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var specialChar=_step7.value;text=text.replace(specialChar[1],specialChar[0])}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7["return"]&&_iterator7["return"]()}finally{if(_didIteratorError7)throw _iteratorError7}}return text}}]),$$$$$$models$Tune$es6lib$$Tune}(),$$$$$$models$Tune$es6lib$$default=$$$$$$models$Tune$es6lib$$Tune;$$$$$$Config$es6lib$$default.isTesting&&!function(){$$$$$$models$Tune$es6lib$$Tune._convertSpecialChars("{\\aa} \\aa &aring; \\u00e5 \\`A \\'A \\^A \\~A \\\"A \\cC \\/O {\\uA}")}();var $$pages$about$AboutController$es6lib$$AboutController=function(_$$$$$$ControllerBase$es6lib$$default){function $$pages$about$AboutController$es6lib$$AboutController($scope,$rootScope,$routeParams,$http,$timeout,$location){_classCallCheck(this,$$pages$about$AboutController$es6lib$$AboutController),_get(Object.getPrototypeOf($$pages$about$AboutController$es6lib$$AboutController.prototype),"constructor",this).call(this,$scope),this.$routeParams=$routeParams,this.$http=$http,this.$timeout=$timeout,this.$location=$location,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.showLoading=!0,this.showNoResults=!1,this.showResults=!1,this.showTunebooksLoading=!0,this.showTunebooksNoResults=!1,this.showTunebooksResults=!1,document.title="Tunepal.org > About",this._fetchDownloads(),this._fetchTunebooks()}return _inherits($$pages$about$AboutController$es6lib$$AboutController,_$$$$$$ControllerBase$es6lib$$default),_createClass($$pages$about$AboutController$es6lib$$AboutController,[{key:"_fetchTunebooks",value:function(){var _this3=this,url=this.config.ApiDomain+"/api/Sources";this.$http.get(url).success(function(rawTunebooks){_this3.tunebooks=[];var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=rawTunebooks[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var rawTunebook=_step8.value;_this3.tunebooks.push(new $$$$$$models$Tunebook$es6lib$$default(rawTunebook))}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{!_iteratorNormalCompletion8&&_iterator8["return"]&&_iterator8["return"]()}finally{if(_didIteratorError8)throw _iteratorError8}}_this3._initTunebooks()})}},{key:"_initTunebooks",value:function(){0===this.tunebooks.length?this.showNoTunebooksResults=!0:this.showTunebooksResults=!0,this.showTunebooksLoading=!1}},{key:"_fetchDownloads",value:function(){var _this4=this,url=this.config.ApiDomain+"/api/downloads";this.$http.get(url).success(function(rawTunes){_this4.tunes=[];var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=rawTunes[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var rawTune=_step9.value;_this4.tunes.push(new $$$$$$models$Tune$es6lib$$default(rawTune))}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{!_iteratorNormalCompletion9&&_iterator9["return"]&&_iterator9["return"]()}finally{if(_didIteratorError9)throw _iteratorError9}}_this4._initTunes()})}},{key:"_initTunes",value:function(){0===this.tunes.length?this.showNoResults=!0:(this.pageSize=10,this.pages=this._calcPages(this.tunes,this.pageSize),this._initUi(),this.showResults=!0),this.showLoading=!1}},{key:"_initUi",value:function(){}}]),$$pages$about$AboutController$es6lib$$AboutController}($$$$$$ControllerBase$es6lib$$default),$$pages$about$AboutController$es6lib$$default=$$pages$about$AboutController$es6lib$$AboutController,$$pages$discography$DiscographyController$es6lib$$DiscographyController=function(_$$$$$$ControllerBase$es6lib$$default2){function $$pages$discography$DiscographyController$es6lib$$DiscographyController($scope,$routeParams,$http){_classCallCheck(this,$$pages$discography$DiscographyController$es6lib$$DiscographyController),_get(Object.getPrototypeOf($$pages$discography$DiscographyController$es6lib$$DiscographyController.prototype),"constructor",this).call(this,$scope),this.$routeParams=$routeParams,this.$http=$http,this.showLoading=!0,this.showNoResults=!1,this.showResults=!1,this.keywordEncoded=$routeParams.keywordEncoded,this.keyword=decodeURIComponent(this.keywordEncoded),this._fetchTunes()}return _inherits($$pages$discography$DiscographyController$es6lib$$DiscographyController,_$$$$$$ControllerBase$es6lib$$default2),_createClass($$pages$discography$DiscographyController$es6lib$$DiscographyController,[{key:"_fetchTunes",value:function(){var _this5=this,q=this.keywordEncoded,url=$$$$$$Config$es6lib$$default.ApiDomain+"/api/Discography?q="+q;this.$http.get(url).success(function(tunes){if(0===tunes.length)_this5.showNoResults=!0;else{var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=tunes[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){var tune=_step10.value;tune.queryEncoded=encodeURIComponent(tune.title+" "+tune.artist)}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{!_iteratorNormalCompletion10&&_iterator10["return"]&&_iterator10["return"]()}finally{if(_didIteratorError10)throw _iteratorError10}}_this5.tunes=tunes,_this5.pageSize=10,_this5.pages=_this5._calcPages(_this5.tunes,_this5.pageSize),_this5.showResults=!0}_this5.showLoading=!1})}}]),$$pages$discography$DiscographyController$es6lib$$DiscographyController}($$$$$$ControllerBase$es6lib$$default),$$pages$discography$DiscographyController$es6lib$$default=$$pages$discography$DiscographyController$es6lib$$DiscographyController,$$EuropeanaTune$es6lib$$EuropeanaTune=function(){function $$EuropeanaTune$es6lib$$EuropeanaTune(){_classCallCheck(this,$$EuropeanaTune$es6lib$$EuropeanaTune)}return _createClass($$EuropeanaTune$es6lib$$EuropeanaTune,null,[{key:"fromSearch",value:function(rawTune){var tune=new $$EuropeanaTune$es6lib$$EuropeanaTune;return tune.title=rawTune.title&&rawTune.title[0],tune.preview=rawTune.edmPreview&&rawTune.edmPreview[0]||"http://europeana.eu/Logo.jpg",tune.provider=rawTune.dataProvider&&rawTune.dataProvider[0],tune.author=rawTune.dcContributor&&rawTune.dcContributor[0],tune.year=rawTune.year&&rawTune.year[0],tune.tunePageInProvider=rawTune.edmIsShownAt&&rawTune.edmIsShownAt[0]||rawTune.edmIsShownBy&&rawTune.edmIsShownBy[0],tune.tunePageInEuropeana=rawTune.guid,tune}},{key:"fromRecord",value:function(rawTune,$sce){var tune=new $$EuropeanaTune$es6lib$$EuropeanaTune;return tune.title=rawTune.proxies[0].dcTitle&&rawTune.proxies[0].dcTitle.def[0],tune.preview=rawTune.europeanaAggregation.edmPreview||"http://europeana.eu/Logo.jpg",tune.provider=rawTune.aggregations[0].edmDataProvider&&rawTune.aggregations[0].edmDataProvider.def[0],tune.year=rawTune.proxies[0].dcDate&&rawTune.proxies[0].dcDate.def[0],tune.tunePageInProvider=rawTune.aggregations[0].edmIsShownAt||rawTune.aggregations[0].edmIsShownBy,tune.tunePageInEuropeana=rawTune.europeanaAggregation.edmLandingPage,tune.audioUrl=$sce.trustAsResourceUrl(rawTune.aggregations[0].edmIsShownBy),tune.author="Irish Traditional Music Archive"===tune.provider?rawTune.proxies[0].dcCreator&&rawTune.proxies[0].dcCreator.def[0]:rawTune.proxies[0].dcContributor&&rawTune.proxies[0].dcContributor.def[0],tune}}]),$$EuropeanaTune$es6lib$$EuropeanaTune}(),$$EuropeanaTune$es6lib$$default=$$EuropeanaTune$es6lib$$EuropeanaTune,$$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi=function(){function $$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi(){_classCallCheck(this,$$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi),this._providers=["Comhaltas Traditional Music Archive","Irish Traditional Music Archive"],this._qfProvider=this._getProviders(this._providers)}return _createClass($$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi,[{key:"rawSearchAsync",value:function($http,tune){var _this6=this,start=arguments.length<=2||void 0===arguments[2]?1:arguments[2],maxNumItems=arguments.length<=3||void 0===arguments[3]?20:arguments[3];return new Promise(function(resolve,reject){var apiDomain=$$$$$$Config$es6lib$$default.EuropeanaApiDomain,apiKey=$$$$$$Config$es6lib$$default.EuropeanaApiKey,profile="portal",qfSound=encodeURIComponent("TYPE:SOUND"),qfProvider=_this6._qfProvider,query=_this6._getQuery(tune.title,tune.altTitle),url=apiDomain+"/search.json?wskey="+apiKey+"&query="+query+"&qf="+qfSound+"&qf="+qfProvider+"&start="+start+"&rows="+maxNumItems+"&profile="+profile;$http.get(url).success(function(rawResults){return resolve(rawResults)})})}},{key:"fetchRecordAsync",value:function($http,europeanaId){return new Promise(function(resolve,reject){var apiDomain=$$$$$$Config$es6lib$$default.EuropeanaApiDomain,apiKey=$$$$$$Config$es6lib$$default.EuropeanaApiKey,url=apiDomain+"/record"+europeanaId+".json?wskey="+apiKey;$http.get(url).success(function(rawResult){return resolve(rawResult)})})}},{key:"getPortalUrl",value:function(tune){var domain=$$$$$$Config$es6lib$$default.EuropeanaPortalDomain,query=this._getQuery(tune.title,tune.altTitle),qfSound=encodeURIComponent("f[TYPE][]")+"=SOUND",qfProvider=this._providers.map(function(provider){return"&"+encodeURIComponent("f[DATA_PROVIDER][]")+"="+encodeURIComponent(provider)}).join("");return domain+"?q="+query+"&"+qfSound+qfProvider}},{key:"searchAsync",value:function($http,tune){var start=arguments.length<=2||void 0===arguments[2]?1:arguments[2],maxNumItems=arguments.length<=3||void 0===arguments[3]?20:arguments[3];return this.rawSearchAsync($http,tune,start,maxNumItems).then(function(rawResults){var results={totalResults:rawResults.totalResults};if(!rawResults.items)return results.items=[],Promise.resolve(results);results.items=new Array(rawResults.items.length);for(var i=0;i<results.items.length;i++)results.items[i]=$$EuropeanaTune$es6lib$$default.fromSearch(rawResults.items[i]);return Promise.resolve(results)})}},{key:"searchFetchAsync",value:function($http,tune,$sce){var _this7=this,start=arguments.length<=3||void 0===arguments[3]?1:arguments[3],maxNumItems=arguments.length<=4||void 0===arguments[4]?20:arguments[4];return this.rawSearchAsync($http,tune,start,maxNumItems).then(function(rawResults){var results={totalResults:rawResults.totalResults};if(!rawResults.items)return results.items=[],Promise.resolve(results);results.items=new Array(rawResults.items.length);for(var promises=new Array(rawResults.items.length),_loop2=function(i){promises[i]=_this7.fetchRecordAsync($http,rawResults.items[i].id).then(function(rawResult){results.items[i]=$$EuropeanaTune$es6lib$$default.fromRecord(rawResult.object,$sce)})},i=0;i<results.items.length;i++)_loop2(i);return Promise.all(promises).then(function(){return Promise.resolve(results)})})}},{key:"_getQuery",value:function(){for(var _len2=arguments.length,keywords=Array(_len2),_key2=0;_key2<_len2;_key2++)keywords[_key2]=arguments[_key2];if(0===keywords.length)return"";for(var query="("+this._cleanupQuery(keywords[0])+")",i=1;i<keywords.length;i++)if(keywords[i]){var keyword=this._cleanupQuery(keywords[i]);query+=query.length>0?" OR ("+keyword+")":"("+keyword+")"}return encodeURIComponent(query)}},{key:"_cleanupQuery",value:function(keyword){return keyword?(keyword=keyword.replace(/\b(reel|jig|hornpipe|polka|waltz|mazurka|THE|AT|AND|OF|TO|BUT|SO|FOR|AN|I|IN|ON|YOUR|A|WITH)\b|[\u2000-\u206F\u2E00-\u2E7F\\'!"#\$%&\(\)\*\+,\-\.\/:;<=>\?@\[\]\^_`\{\|\}~]/gi,""),keyword=keyword.replace(/(\s)+/g," "),keyword=keyword.trim()):""}},{key:"_getProviders",value:function(providers){if(0===providers.length)return"";for(var query='DATA_PROVIDER:"'+providers[0]+'"',i=1;i<providers.length;i++)query+=' OR "'+providers[i]+'"';return encodeURIComponent(query)}}]),$$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi}(),$$$$$$models$EuropeanaApi$es6lib$$EuropeanaApi=new $$$$$$models$EuropeanaApi$es6lib$$_EuropeanaApi,$$$$$$models$EuropeanaApi$es6lib$$default=$$$$$$models$EuropeanaApi$es6lib$$EuropeanaApi;$$$$$$Config$es6lib$$default.isTesting&&!function(){$$$$$$models$EuropeanaApi$es6lib$$EuropeanaApi._cleanupQuery("ABC DEF reel polka the At I A., | {} HIJ")}();var $$$$$$models$TunepalApi$es6lib$$_TunepalApi=function(){function $$$$$$models$TunepalApi$es6lib$$_TunepalApi(){_classCallCheck(this,$$$$$$models$TunepalApi$es6lib$$_TunepalApi)}return _createClass($$$$$$models$TunepalApi$es6lib$$_TunepalApi,[{key:"fetchTuneAsync",value:function($http,tunepalIdEncoded){return new Promise(function(resolve,reject){var url=$$$$$$Config$es6lib$$default.ApiDomain+"/api/Tunes/"+tunepalIdEncoded;$http.get(url).success(function(rawTune){var tune=new $$$$$$models$Tune$es6lib$$default(rawTune);$$utils$Utils$es6lib$$default.cache.tune=tune,resolve(tune)})})}}]),$$$$$$models$TunepalApi$es6lib$$_TunepalApi}(),$$$$$$models$TunepalApi$es6lib$$TunepalApi=new $$$$$$models$TunepalApi$es6lib$$_TunepalApi,$$$$$$models$TunepalApi$es6lib$$default=$$$$$$models$TunepalApi$es6lib$$TunepalApi,$$pages$europeana$EuropeanaController$es6lib$$EuropeanaController=function(_$$$$$$ControllerBase$es6lib$$default3){function $$pages$europeana$EuropeanaController$es6lib$$EuropeanaController($scope,$rootScope,$routeParams,$http,$timeout,$location,$sce){var _this8=this;_classCallCheck(this,$$pages$europeana$EuropeanaController$es6lib$$EuropeanaController),_get(Object.getPrototypeOf($$pages$europeana$EuropeanaController$es6lib$$EuropeanaController.prototype),"constructor",this).call(this,$scope),this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.$http=$http,this.$timeout=$timeout,this.$location=$location,this.$sce=$sce,this.showLoading=!0,this.showNoResults=!1,this.showResults=!1;var tunepalIdEncoded=$routeParams.tunepalIdEncoded,tunepalId=decodeURIComponent(tunepalIdEncoded);$$utils$Utils$es6lib$$default.cache.tune.tunepalId===tunepalId?(this.tune=$$utils$Utils$es6lib$$default.cache.tune,this._search()):$$$$$$models$TunepalApi$es6lib$$default.fetchTuneAsync(this.$http,tunepalIdEncoded).then(function(tune){_this8.tune=tune,_this8._search()})}return _inherits($$pages$europeana$EuropeanaController$es6lib$$EuropeanaController,_$$$$$$ControllerBase$es6lib$$default3),_createClass($$pages$europeana$EuropeanaController$es6lib$$EuropeanaController,[{key:"_search",value:function(){var _this9=this;$$utils$Utils$es6lib$$default.cache.europeana.id===this.tune.tunepalId?this._initResults($$utils$Utils$es6lib$$default.cache.europeana.results):$$$$$$models$EuropeanaApi$es6lib$$default.searchFetchAsync(this.$http,this.tune,this.$sce).then(this.apply(function(results){return _this9._initResults(results)})),document.title="Tunepal.org > Europeana Search > "+this.tune.title}},{key:"_initResults",value:function(results){this.results=results,results.items.length>0?(this.pageSize=10,this.pages=this._calcPages(this.results.items,this.pageSize),this._initUi(),this.showResults=!0):this.showNoResults=!0,this.showLoading=!1}},{key:"_initUi",value:function(){var _this10=this;this.$timeout(function(){return _this10.utils.view.initTooltips()})}}]),$$pages$europeana$EuropeanaController$es6lib$$EuropeanaController}($$$$$$ControllerBase$es6lib$$default),$$pages$europeana$EuropeanaController$es6lib$$default=$$pages$europeana$EuropeanaController$es6lib$$EuropeanaController,$$pages$help$HelpController$es6lib$$HelpController=function(_$$$$$$ControllerBase$es6lib$$default4){function $$pages$help$HelpController$es6lib$$HelpController($scope,$rootScope,$routeParams,$http,$timeout,$location){_classCallCheck(this,$$pages$help$HelpController$es6lib$$HelpController),_get(Object.getPrototypeOf($$pages$help$HelpController$es6lib$$HelpController.prototype),"constructor",this).call(this,$scope),this.$routeParams=$routeParams,this.$http=$http,this.$timeout=$timeout,this.$location=$location,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,document.title="Tunepal.org > Help"}return _inherits($$pages$help$HelpController$es6lib$$HelpController,_$$$$$$ControllerBase$es6lib$$default4),$$pages$help$HelpController$es6lib$$HelpController}($$$$$$ControllerBase$es6lib$$default),$$pages$help$HelpController$es6lib$$default=$$pages$help$HelpController$es6lib$$HelpController,$$pages$index$IndexController$es6lib$$IndexController=function(){function $$pages$index$IndexController$es6lib$$IndexController($scope,$rootScope,$location){_classCallCheck(this,$$pages$index$IndexController$es6lib$$IndexController),this.$rootScope=$rootScope,this.$location=$location,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,$rootScope.$on("$routeChangeStart",function(){$(".material-tooltip").remove()})}return _createClass($$pages$index$IndexController$es6lib$$IndexController,[{key:"isActive",value:function(route){return 0===this.$location.path().indexOf(route)}}]),$$pages$index$IndexController$es6lib$$IndexController}(),$$pages$index$IndexController$es6lib$$default=$$pages$index$IndexController$es6lib$$IndexController,$$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController=function(_$$$$$$ControllerBase$es6lib$$default5){function $$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController($scope,$rootScope,$routeParams,$http,$timeout,$location,$sce){_classCallCheck(this,$$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController),_get(Object.getPrototypeOf($$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController.prototype),"constructor",this).call(this,$scope),this.$routeParams=$routeParams,this.$http=$http,this.$timeout=$timeout,this.$location=$location,this.$sce=$sce,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.keywordEncoded=$routeParams.keywordEncoded,this.keyword=this.keywordEncoded&&decodeURIComponent(this.keywordEncoded),this.selectedTunepalIdEncoded=$routeParams.selectedTunepalIdEncoded,this.selectedTunepalId=this.selectedTunepalIdEncoded&&decodeURIComponent(this.selectedTunepalIdEncoded),this.showLoading=null!=this.keyword,this.showResults=!1,this.showNoResults=!1,this.showEuropeanaLoading=!1,this.showEuropeanaResults=!1,this.showEuropeanaNoResults=!1,this.keyword?($$utils$Utils$es6lib$$default.cache.keywordSearch.keyword===this.keyword?(this.tunes=$$utils$Utils$es6lib$$default.cache.keywordSearch.results,this._initTunes()):this._fetchTunes(),document.title="Tunepal.org > Keyword Search > "+this.keyword):($timeout(function(){return $("#keyword").focus()}),document.title="Tunepal.org > Keyword Search")}return _inherits($$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController,_$$$$$$ControllerBase$es6lib$$default5),_createClass($$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController,[{key:"_fetchTunes",value:function(){var _this11=this,q=this.keywordEncoded,sources=$$utils$Utils$es6lib$$default.joinSet(this.config.tunebooks.selectedIds),latitude=1,longitude=2,client="tunepal.org",localTimestamp=$$utils$Utils$es6lib$$default.date.format(new Date),url=this.config.ApiDomain+"/api/keywordSearch?q="+q+("&sources="+sources)+("&latitude="+latitude)+("&longitude="+longitude)+("&client="+client)+("&key_sigs="+this.config.timeSigs)+("&local_tstamp="+localTimestamp);this.$http.get(url).success(function(rawTunes){_this11.tunes=[];var _iteratorNormalCompletion11=!0,_didIteratorError11=!1,_iteratorError11=void 0;try{for(var _step11,_iterator11=rawTunes[Symbol.iterator]();!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=!0){var rawTune=_step11.value;_this11.tunes.push(new $$$$$$models$Tune$es6lib$$default(rawTune))}}catch(err){_didIteratorError11=!0,_iteratorError11=err}finally{try{!_iteratorNormalCompletion11&&_iterator11["return"]&&_iterator11["return"]()}finally{if(_didIteratorError11)throw _iteratorError11}}$$utils$Utils$es6lib$$default.cache.keywordSearch={keyword:_this11.keyword,results:_this11.tunes},_this11._initTunes()})}},{key:"_initTunes",value:function(){0===this.tunes.length?this.showNoResults=!0:(this.pageSize=10,this.pages=this._calcPages(this.tunes,this.pageSize),this._initUi(),this.showResults=!0),this.showLoading=!1}},{key:"_initUi",value:function(){}},{key:"_initEuropeana",value:function(){var _this12=this;this.showEuropeanaLoading=!0,this.selectedTunepalId?(this.selectedTune=this.tunes.find(function(tune){return tune.tunepalId===_this12.selectedTunepalId}),this.selectedTune?this._searchEuropeana():$$$$$$models$TunepalApi$es6lib$$default.fetchTuneAsync(this.$http,this.selectedTunepalIdEncoded).then(function(tune){_this12.selectedTune=tune,_this12._searchEuropeana()})):(this.selectedTune=new $$$$$$models$Tune$es6lib$$default({tunepalid:this.keyword,title:this.keyword}),this._searchEuropeana())}},{key:"_searchEuropeana",value:function(){var _this13=this;this.europeanaPortalUrl=$$$$$$models$EuropeanaApi$es6lib$$default.getPortalUrl(this.selectedTune),$$utils$Utils$es6lib$$default.cache.europeana.id===this.selectedTune.tunepalId?this._initEuropeanaResults($$utils$Utils$es6lib$$default.cache.europeana.results):$$$$$$models$EuropeanaApi$es6lib$$default.searchFetchAsync(this.$http,this.selectedTune,this.$sce).then(this.apply(function(results){return _this13._initEuropeanaResults(results)}))}},{key:"_initEuropeanaResults",value:function(results){var _this14=this;results.items.length>0?(this.europeanaPageSize=10,this.europeanaPages=this._calcPages(results.items,this.europeanaPageSize),this.europeana=results,this.$timeout(function(){return _this14.utils.view.initTooltips()}),this.showEuropeanaResults=!0,this.showEuropeanaLoading=!1):(this.showEuropeanaLoading=!1,this.showEuropeanaNoResults=!0)}},{key:"searchKeyword",value:function(){$("#keyword").blur(),this.$location.url("/keywordSearch/"+$$utils$Utils$es6lib$$default.view.doubleEncode(this.keyword))}},{key:"clearKeyword",value:function(){$("#keyword").focus(),this.keyword=""}},{key:"select",value:function(tune){this.selectedTune.tunepalId===tune.tunepalId?this.$location.url("/keywordSearch/"+$$utils$Utils$es6lib$$default.view.doubleEncode(this.keyword)):this.$location.url("/keywordSearch/"+$$utils$Utils$es6lib$$default.view.doubleEncode(this.keyword)+"/"+tune.tunepalIdDoubleEncoded),this.$location.replace()}}]),$$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController}($$$$$$ControllerBase$es6lib$$default),$$pages$keywordSearch$KeywordSearchController$es6lib$$default=$$pages$keywordSearch$KeywordSearchController$es6lib$$KeywordSearchController,$$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController=function(_$$$$$$ControllerBase$es6lib$$default6){function $$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController($scope,$rootScope,$routeParams,$http,$timeout,$location,$sce){_classCallCheck(this,$$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController),_get(Object.getPrototypeOf($$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController.prototype),"constructor",this).call(this,$scope),this.$routeParams=$routeParams,this.$http=$http,this.$timeout=$timeout,this.$location=$location,this.$sce=$sce,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.notes=$routeParams.notes,this.selectedTunepalIdEncoded=$routeParams.selectedTunepalIdEncoded,this.selectedTunepalId=this.selectedTunepalIdEncoded&&decodeURIComponent(this.selectedTunepalIdEncoded),this.showLoading=!0,this.showResults=!1,this.showNoResults=!1,this.showError=!1,this.showEuropeanaLoading=!1,this.showEuropeanaResults=!1,this.showEuropeanaNoResults=!1,$$utils$Utils$es6lib$$default.cache.notesSearch.notes===this.notes?(this.tunes=$$utils$Utils$es6lib$$default.cache.notesSearch.results,this.showConfidencePopup=!1,this._initTunes()):(this.showConfidencePopup=!0,this._getGeolocationAndFetchTunes()),document.title="Tunepal.org > Notes Search"}return _inherits($$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController,_$$$$$$ControllerBase$es6lib$$default6),_createClass($$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController,[{key:"_getGeolocationAndFetchTunes",value:function(){var _this15=this,fakePosition={coords:{latitude:1,longitude:2}};navigator&&navigator.geolocation&&"function"==typeof navigator.geolocation.getCurrentPosition?navigator.geolocation.getCurrentPosition(function(position){return _this15._fetchTunes(position)},function(err){return _this15._fetchTunes(fakePosition)}):this._fetchTunes(fakePosition)}},{key:"_fetchTunes",value:function(position){var _this16=this,sources=$$utils$Utils$es6lib$$default.joinSet(this.config.tunebooks.selectedIds),latitude=position.coords.latitude,longitude=position.coords.longitude,client="tunepal.org",localTimestamp=$$utils$Utils$es6lib$$default.date.format(new Date),url=this.config.ApiDomain+"/api/mattSearch?q="+this.notes+("&sources="+sources)+("&latitude="+latitude)+("&longitude="+longitude)+("&client="+client)+("&key_sigs="+this.config.timeSigs)+("&local_tstamp="+localTimestamp);this.$http.get(url).success(function(rawTunes){_this16.tunes=[];var _iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _step12,_iterator12=rawTunes[Symbol.iterator]();!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var rawTune=_step12.value;_this16.tunes.push(new $$$$$$models$Tune$es6lib$$default(rawTune))}}catch(err){_didIteratorError12=!0,_iteratorError12=err}finally{try{!_iteratorNormalCompletion12&&_iterator12["return"]&&_iterator12["return"]()}finally{if(_didIteratorError12)throw _iteratorError12}}$$utils$Utils$es6lib$$default.cache.notesSearch={notes:_this16.notes,results:_this16.tunes},_this16._initTunes()})}},{key:"_initTunes",value:function(){0===this.tunes.length?this.showNoResults=!0:this.tunes[0].id===-1?(this.error=this.tunes[0].title,this.showError=!0):(this.pageSize=10,this.pages=this._calcPages(this.tunes,this.pageSize),this._initUi(),this.showResults=!0,this._initEuropeana()),this.showLoading=!1}},{key:"_initUi",value:function(){this.showConfidencePopup&&$("#confidence-popup").openModal()}},{key:"_initEuropeana",value:function(){var _this17=this;this.showEuropeanaLoading=!0,this.selectedTunepalId?(this.selectedTune=this.tunes.find(function(tune){return tune.tunepalId===_this17.selectedTunepalId}),this.selectedTune?this._searchEuropeana():$$$$$$models$TunepalApi$es6lib$$default.fetchTuneAsync(this.$http,this.selectedTunepalIdEncoded).then(function(tune){_this17.selectedTune=tune,_this17._searchEuropeana()})):(this.selectedTune=this.tunes[0],this._searchEuropeana())}},{key:"_searchEuropeana",value:function(){var _this18=this;this.europeanaPortalUrl=$$$$$$models$EuropeanaApi$es6lib$$default.getPortalUrl(this.selectedTune),$$utils$Utils$es6lib$$default.cache.europeana.id===this.selectedTune.tunepalId?this._initEuropeanaResults($$utils$Utils$es6lib$$default.cache.europeana.results):$$$$$$models$EuropeanaApi$es6lib$$default.searchFetchAsync(this.$http,this.selectedTune,this.$sce).then(this.apply(function(results){return _this18._initEuropeanaResults(results)}))}},{key:"_initEuropeanaResults",value:function(results){var _this19=this;results.items.length>0?(this.europeanaPageSize=10,this.europeanaPages=this._calcPages(results.items,this.europeanaPageSize),this.europeana=results,this.$timeout(function(){return _this19.utils.view.initTooltips()}),this.showEuropeanaResults=!0,this.showEuropeanaLoading=!1):(this.showEuropeanaLoading=!1,this.showEuropeanaNoResults=!0)}},{key:"select",value:function(tune){this.$location.url("/notesSearch/"+this.notes+"/"+tune.tunepalIdDoubleEncoded),this.$location.replace()}}]),$$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController}($$$$$$ControllerBase$es6lib$$default),$$pages$notesSearch$NotesSearchController$es6lib$$default=$$pages$notesSearch$NotesSearchController$es6lib$$NotesSearchController,$$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController=function(_$$$$$$ControllerBase$es6lib$$default7){function $$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController($scope,$http,$location){_classCallCheck(this,$$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController),_get(Object.getPrototypeOf($$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController.prototype),"constructor",this).call(this,$scope),this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default;var url=this.config.ApiDomain+"/api/RandomTune";$http.get(url).success(function(rawTune){var tune=new $$$$$$models$Tune$es6lib$$default(rawTune);$$utils$Utils$es6lib$$default.cache.tune=tune,$location.url("/tune/"+tune.tunepalIdDoubleEncoded),$location.replace()})}return _inherits($$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController,_$$$$$$ControllerBase$es6lib$$default7),$$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController}($$$$$$ControllerBase$es6lib$$default),$$pages$randomTune$RandomTuneController$es6lib$$default=$$pages$randomTune$RandomTuneController$es6lib$$RandomTuneController,$$$$$$transcription$TranscriberAsync$es6lib$$WorkerPath="scripts/transcription/TranscriberWorker.js",$$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync=function(){function $$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync(){var _this20=this;_classCallCheck(this,$$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync),this._worker=new Worker($$$$$$transcription$TranscriberAsync$es6lib$$WorkerPath),this._worker.addEventListener("message",function(e){return _this20._onMessage(e)}),this._callbacks=[],this._nextId=0,this.onProgress=function(){}}return _createClass($$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync,[{key:"initAsync",value:function(params){return this._postMessageAsync({cmd:"init",msg:params})}},{key:"resetSignalAsync",value:function(){return this._postMessageAsync({cmd:"resetSignal"})}},{key:"getSignalAsync",value:function(){return this._postMessageAsync({cmd:"getSignal"})}},{key:"pushSignalAsync",value:function(signal){return this._postMessageAsync({cmd:"pushSignal",msg:signal})}},{key:"transcribeAsync",value:function(params){return this._postMessageAsync({cmd:"transcribe",msg:params})}},{key:"close",value:function(){return this._postMessageAsync({cmd:"close"})}},{key:"_postMessageAsync",value:function(msg){var _this21=this;return new Promise(function(resolve,reject){var id=_this21._nextId++;_this21._callbacks[id]={resolve:resolve,reject:reject},msg.id=id,_this21._worker.postMessage(msg)})}},{key:"_onMessage",value:function(e){var data=e.data;switch(data.cmd){case"onProgress":this.onProgress(data.msg);break;default:var id=data.id;"success"==data.result?this._callbacks[id].resolve(data.msg):this._callbacks[id].reject(data.msg),this._callbacks[id]=null}}}]),$$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync}(),$$$$$$transcription$TranscriberAsync$es6lib$$default=$$$$$$transcription$TranscriberAsync$es6lib$$TranscriberAsync,$$Recorder$es6lib$$Recorder=function(){function $$Recorder$es6lib$$Recorder(config,audioContext){var _this22=this;_classCallCheck(this,$$Recorder$es6lib$$Recorder),this.config=config,this._status=$$Recorder$es6lib$$Recorder.Status.STOPPED,this._audioContext=audioContext,this.onTranscribed=function(){},this._transcriber=new $$$$$$transcription$TranscriberAsync$es6lib$$default,this._transcriber.onProgress=function(progress){return _this22.analysisProgress=progress}}return _createClass($$Recorder$es6lib$$Recorder,[{key:"sampleTime",get:function(){return this.config.sampleTime},set:function(value){this.config.sampleTime=value}},{key:"blankTime",get:function(){return this.config.blankTime},set:function(value){this.config.blankTime=value}},{key:"fundamental",get:function(){return this.config.fundamental},set:function(value){this.config.fundamental=value}},{key:"enableSampleRateConversion",get:function(){return this.config.enableSampleRateConversion;
},set:function(value){this.config.enableSampleRateConversion=value}},{key:"transcriberFrameSize",get:function(){return this.config.transcriberFrameSize},set:function(value){this.config.transcriberFrameSize=value}},{key:"audioContext",get:function(){return this._audioContext}},{key:"sampleRate",get:function(){return this._audioContext.sampleRate}},{key:"amplitude",get:function(){return this._amplitude}},{key:"timeRecorded",get:function(){return this._timeRecorded}},{key:"transcription",get:function(){return this._transcription}},{key:"progress",get:function(){return this._timeRecorded/(this.blankTime+this.sampleTime)}},{key:"numSamples",get:function(){return this._audioContext.sampleRate*this.sampleTime}},{key:"status",get:function(){return this._status}},{key:"signal",get:function(){return this._signal}}]),_createClass($$Recorder$es6lib$$Recorder,[{key:"initAsync",value:function(){var _this23=this;return new Promise(function(resolve,reject){_this23._stream?(_this23._status=$$Recorder$es6lib$$Recorder.Status.INIT_SUCCEEDED,resolve()):navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(_this23._status=$$Recorder$es6lib$$Recorder.Status.INIT,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(stream){return _this23._onStream(stream,resolve)})["catch"](function(error){return _this23._onStreamError(error,reject)})):_this23._status=$$Recorder$es6lib$$Recorder.Status.API_MISSING})}},{key:"close",value:function(){this._transcriber.close()}},{key:"_onStream",value:function(stream,resolve){var _this24=this;this._stream=stream,this._bufferSize=4096,this._input=this._audioContext.createMediaStreamSource(stream),this._processor=this._audioContext.createScriptProcessor(this._bufferSize,1,1),this._processor.onaudioprocess=function(e){return _this24._update(e)},this._input.connect(this._processor),this._processor.connect(this._audioContext.destination),this._status=$$Recorder$es6lib$$Recorder.Status.INIT_SUCCEEDED,resolve()}},{key:"_onStreamError",value:function(error,reject){this._status=$$Recorder$es6lib$$Recorder.Status.INIT_FAILED,reject(error)}},{key:"start",value:function(){var _this25=this;if(this._stream){var initParams={inputSampleRate:this._audioContext.sampleRate,sampleTime:this.sampleTime,blankTime:this.blankTime,fundamental:this.fundamental,enableSampleRateConversion:this.enableSampleRateConversion,frameSize:this.transcriberFrameSize};this._transcriber.initAsync(initParams).then(function(){return _this25._status=$$Recorder$es6lib$$Recorder.Status.RECORDING})}}},{key:"stop",value:function(){this._status=$$Recorder$es6lib$$Recorder.Status.STOPPED,this._amplitude=0,this._timeRecorded=0}},{key:"destroy",value:function(){this._status=$$Recorder$es6lib$$Recorder.Status.STOPPED,this._stream&&this._stream.stop(),this._stream=null}},{key:"_update",value:function(e){var _this26=this;if(this._status==$$Recorder$es6lib$$Recorder.Status.RECORDING){var audio=e.inputBuffer,signalBuffer=audio.getChannelData(0);this._transcriber.pushSignalAsync(signalBuffer).then(function(msg){return _this26._analyzeSignal(msg)})}}},{key:"_analyzeSignal",value:function(msg){var _this27=this;this._amplitude=msg.amplitude,this._timeRecorded=msg.timeRecorded,msg.isBufferFull&&(this.stop(),this._status=$$Recorder$es6lib$$Recorder.Status.ANALYZING,this._transcriber.transcribeAsync().then(function(result){return _this27._status=$$Recorder$es6lib$$Recorder.Status.ANALYSIS_SUCCEEDED,_this27.onTranscribed(result),_this27._transcriber.getSignalAsync()}).then(function(signal){_this27._signal=signal}))}}]),$$Recorder$es6lib$$Recorder}(),$$Recorder$es6lib$$default=$$Recorder$es6lib$$Recorder;$$Recorder$es6lib$$Recorder.Status=$$utils$Utils$es6lib$$default.createEnum(["STOPPED","INIT","INIT_SUCCEEDED","INIT_FAILED","RECORDING","ANALYZING","ANALYSIS_SUCCEEDED","API_MISSING"]);var $$Renderer$es6lib$$LogoPath="images/recording_logo.png",$$Renderer$es6lib$$Renderer=function(){function $$Renderer$es6lib$$Renderer(config,recorder,canvas,container){var _this28=this;_classCallCheck(this,$$Renderer$es6lib$$Renderer),this.config=config,this.recorder=recorder,this._canvas=canvas,this._container=container,this._logo=new Image,this._logo.addEventListener("load",function(){return _this28._updateMetrics()}),this._logo.src=$$Renderer$es6lib$$LogoPath,this._canvas.addEventListener("click",function(){return _this28._recordClicked()}),this._canvasContext=this._canvas.getContext("2d")}return _createClass($$Renderer$es6lib$$Renderer,[{key:"countdownTime",get:function(){return this.config.countdownTime},set:function(value){this.config.countdownTime=value}}]),_createClass($$Renderer$es6lib$$Renderer,[{key:"_recordClicked",value:function(){var _this29=this;if(this.recorder.audioContext.resume(),this._timeLeft>0)return this._timeLeft=0,this.recorder.stop(),void clearInterval(this._timer);switch(this.recorder.status){case $$Recorder$es6lib$$default.Status.STOPPED:case $$Recorder$es6lib$$default.Status.ANALYSIS_SUCCEEDED:this.recorder.initAsync().then(function(){return _this29._startCountingDown()});break;case $$Recorder$es6lib$$default.Status.RECORDING:this.recorder.stop()}}},{key:"_startCountingDown",value:function(){var _this30=this;if(this._timeLeft=this.countdownTime,this._timeLeft<=0?this.recorder.start():this._timer=setInterval(function(){return _this30._countdown()},1e3),$$$$$$Config$es6lib$$default.fundamental!==$$$$$$Config$es6lib$$default.defaults.fundamental){var toast='Warning! Using a fundamental of <span class="highlight-toast">'+$$$$$$Config$es6lib$$default.fundamental+"</span> for transcription.";Materialize.toast(toast,3e3)}}},{key:"_countdown",value:function(){this._timeLeft-=1,this._timeLeft<=0&&(clearInterval(this._timer),this.recorder.start())}},{key:"draw",value:function(){this._updateCanvasSize(),this._canvasContext.save(),this._canvasContext.clearRect(0,0,this._canvas.width,this._canvas.height),this._drawLogo(),this._drawAmplitude(),this._drawProgress(),this._drawStatus(),this._canvasContext.restore()}},{key:"_updateCanvasSize",value:function(){var width=this._container.offsetWidth,height=this._container.offsetHeight;this._diameter=width<height?width:height,this._canvas.width==this._diameter&&this._canvas.height==this._diameter||(this._canvas.width=this._diameter,this._canvas.height=this._diameter,this._updateMetrics())}},{key:"_updateMetrics",value:function(){this._logoCenter={x:.5*this._diameter,y:.4*this._diameter};var logoRadius=.3*this._diameter;this._logoWidth=2*logoRadius,this._logoHeight=this._logoWidth*this._logo.height/this._logo.width,this._logoTopLeft={x:this._logoCenter.x-this._logoWidth/2,y:this._logoCenter.y-this._logoHeight/2},this._ringInnerRadius=.32*this._diameter,this._ringMinWidth=.03*this._diameter,this._ringMaxWidth=.06*this._diameter;var progressOuterRadius=this._ringInnerRadius;this._progressWidth=.015*this._diameter,this._progressRadius=progressOuterRadius-this._progressWidth/2,this._statusTop={x:this._logoCenter.x,y:this._logoCenter.y+this._ringInnerRadius+this._ringMaxWidth+.09*this._diameter}}},{key:"_drawLogo",value:function(){this._canvasContext.drawImage(this._logo,this._logoTopLeft.x,this._logoTopLeft.y,this._logoWidth,this._logoHeight)}},{key:"_drawAmplitude",value:function(){var width=this._ringMinWidth,rate=this.recorder.amplitude;rate&&(rate>1&&(rate=1),rate<0&&(rate=0),width+=(this._ringMaxWidth-this._ringMinWidth)*rate);var radius=this._ringInnerRadius+width/2;this._canvasContext.beginPath(),this._canvasContext.arc(this._logoCenter.x,this._logoCenter.y,radius,0,2*Math.PI),this._canvasContext.lineWidth=width,this._canvasContext.strokeStyle="rgb(176, 210, 13)",this._canvasContext.stroke()}},{key:"_drawProgress",value:function(){if(this.recorder.progress>0){var angle=2*Math.PI*this.recorder.progress,startingAngle=Math.PI/-2,endingAngle=startingAngle+angle;this._canvasContext.beginPath(),this._canvasContext.arc(this._logoCenter.x,this._logoCenter.y,this._progressRadius,startingAngle,endingAngle),this._canvasContext.lineWidth=this._progressWidth,this._canvasContext.strokeStyle="rgba(255, 255, 255, 0.9)",this._canvasContext.stroke()}}},{key:"_drawStatus",value:function(){var status=this._timeLeft>0?"RECORDING IN "+this._timeLeft+" SEC...":this._getRecorderStatusText();this._drawStatusMultiLine(status.split("\n"))}},{key:"_drawStatusMultiLine",value:function(statusTexts){this._canvasContext.font=1==statusTexts.length&&statusTexts[0].length<=27?"3vh Roboto":"2vh Roboto",this._canvasContext.textBaseline="top",this._canvasContext.textAlign="center",this._canvasContext.fillStyle="white";for(var i=0;i<statusTexts.length;i++){var lineHeight=25;this._canvasContext.fillText(statusTexts[i],this._statusTop.x,this._statusTop.y+lineHeight*i)}}},{key:"_getRecorderStatusText",value:function(){switch(this.recorder.status){case $$Recorder$es6lib$$default.Status.STOPPED:return"TAP TO RECORD";case $$Recorder$es6lib$$default.Status.INIT:return"ACCESSING THE MICROPHONE...";case $$Recorder$es6lib$$default.Status.INIT_SUCCEEDED:return"SUCCEEDED";case $$Recorder$es6lib$$default.Status.INIT_FAILED:return"ERROR: PLEASE ALLOW MICROPHONE ACCESS!";case $$Recorder$es6lib$$default.Status.RECORDING:return"RECORDING... (TAP TO STOP)";case $$Recorder$es6lib$$default.Status.ANALYZING:return"ANALYZING... ("+(100*this.recorder.analysisProgress).toFixed(2)+" %)";case $$Recorder$es6lib$$default.Status.ANALYSIS_SUCCEEDED:return"SUCCEEDED";case $$Recorder$es6lib$$default.Status.API_MISSING:return"ERROR: MICROPHONE NOT WORKING.\nPLEASE UPGRADE OR SWITCH BROWSER!"}}}]),$$Renderer$es6lib$$Renderer}(),$$Renderer$es6lib$$default=$$Renderer$es6lib$$Renderer,$$pages$record$RecordController$es6lib$$RecordController=function(_$$$$$$ControllerBase$es6lib$$default8){function $$pages$record$RecordController$es6lib$$RecordController($scope,$rootScope,$location){var _this31=this;_classCallCheck(this,$$pages$record$RecordController$es6lib$$RecordController),_get(Object.getPrototypeOf($$pages$record$RecordController$es6lib$$RecordController.prototype),"constructor",this).call(this,$scope),this.$location=$location,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.audioContext=this.config.audioContext,this.recorder=new $$Recorder$es6lib$$default(this.config,this.audioContext),this.recorder.onTranscribed=function(result){return _this31.onTranscribed(result)};var canvas=$("#canvas")[0],container=canvas.parentNode;this.renderer=new $$Renderer$es6lib$$default(this.config,this.recorder,canvas,container),this._requestId=window.requestAnimationFrame(function(){return _this31._update()}),$scope.$on("$routeChangeStart",function(){window.cancelAnimationFrame(_this31._requestId),_this31.recorder.close()}),document.title="Tunepal.org > Record"}return _inherits($$pages$record$RecordController$es6lib$$RecordController,_$$$$$$ControllerBase$es6lib$$default8),_createClass($$pages$record$RecordController$es6lib$$RecordController,[{key:"_update",value:function(){var _this32=this;this.renderer.draw(),this._requestId=window.requestAnimationFrame(function(){return _this32._update()})}},{key:"onTranscribed",value:function(result){var _this33=this;this.$scope.$apply(function(){_this33.$location.url("/notesSearch/"+result.transcription)})}},{key:"playSignal",value:function(){var _this34=this;this.signalPlayer?(this.signalPlayer.stop(0),this.signalPlayer=null):(this._audio||(this._audio=this.audioContext.createBuffer(1,this.recorder.numSamples,this.recorder.sampleRate),this._audio.copyToChannel(this.recorder.signal,0)),this.signalPlayer=this.audioContext.createBufferSource(),this.signalPlayer.buffer=this._audio,this.signalPlayer.connect(this.audioContext.destination),this.signalPlayer.onended=this.apply(function(){return _this34.signalPlayer=null}),this.signalPlayer.start(0,0,this._audio.duration))}}]),$$pages$record$RecordController$es6lib$$RecordController}($$$$$$ControllerBase$es6lib$$default),$$pages$record$RecordController$es6lib$$default=$$pages$record$RecordController$es6lib$$RecordController,$$pages$settings$SettingsController$es6lib$$SettingsController=function(_$$$$$$ControllerBase$es6lib$$default9){function $$pages$settings$SettingsController$es6lib$$SettingsController($scope,$rootScope,$http,$routeParams,$timeout){var _this35=this;_classCallCheck(this,$$pages$settings$SettingsController$es6lib$$SettingsController),_get(Object.getPrototypeOf($$pages$settings$SettingsController$es6lib$$SettingsController.prototype),"constructor",this).call(this,$scope),this.$http=$http,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default;var options=$routeParams.options;if(options){options=options.split("/"),this.options=[];var _iteratorNormalCompletion13=!0,_didIteratorError13=!1,_iteratorError13=void 0;try{for(var _step13,_iterator13=options[Symbol.iterator]();!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=!0){var option=_step13.value;this.options[option]=!0}}catch(err){_didIteratorError13=!0,_iteratorError13=err}finally{try{!_iteratorNormalCompletion13&&_iterator13["return"]&&_iterator13["return"]()}finally{if(_didIteratorError13)throw _iteratorError13}}}this.options=this.options||{},this.options.dev=!0,this.showLoading=!0,this.showTunebooks=!1,this._initMidiInstruments(),this.validatePlaybackSpeed(),$timeout(function(){return _this35._initPopupOptions()}),document.title="Tunepal.org > Settings"}return _inherits($$pages$settings$SettingsController$es6lib$$SettingsController,_$$$$$$ControllerBase$es6lib$$default9),_createClass($$pages$settings$SettingsController$es6lib$$SettingsController,[{key:"_initPopupOptions",value:function(){var _this36=this;$$utils$Utils$es6lib$$default.view.isLarge&&$(".modal").removeClass("bottom-sheet"),$(".modal-trigger").leanModal({complete:function(){_this36.showLoading=!0,_this36.showTunebooks=!1}}),$(".modal-trigger").each(function(i,trigger){$(trigger).click(function(){var modal=$(trigger.hash),content=modal.find(".modal-content"),current=content.find(".secondary-content").parent();if(null!=current){var scrollTop=current[0].offsetTop+current.outerHeight()-content.height()/2;content.animate({scrollTop:scrollTop},500)}})})}},{key:"_initMidiInstruments",value:function(){$.each($$$$$$Config$es6lib$$default.MidiInstruments,function(i,item){$('select[model="settings.config.melody"]').append($("<option>",{value:item,text:item})),$('select[model="settings.config.chords"]').append($("<option>",{value:item,text:item}))})}},{key:"set",value:function(key,value){this.config[key]=value,$("#"+key+"-sheet").closeModal()}},{key:"setTunebooks",value:function(id){this.config.tunebooks.toggle(id)}},{key:"validatePlaybackSpeed",value:function(){var value=parseInt(this.config.playbackSpeed),input=$('input[ng-model="settings.config.playbackSpeed"]');isNaN(value)||value<=0?input.removeClass("valid").addClass("invalid"):input.removeClass("invalid").addClass("valid")}},{key:"updateTunebooks",value:function(){var _this37=this;this.config.tunebooks.updateTunebooks(this.$http).then(this.apply(function(){_this37.showLoading=!1,_this37.showTunebooks=!0}))}},{key:"expectedAutoFrameSize",get:function(){var sampleRate=this.config.enableSampleRateConversion?22050:this.config.audioContext.sampleRate;return $$utils$Utils$es6lib$$default.transcriber.calcFrameSize(sampleRate)}}]),$$pages$settings$SettingsController$es6lib$$SettingsController}($$$$$$ControllerBase$es6lib$$default),$$pages$settings$SettingsController$es6lib$$default=$$pages$settings$SettingsController$es6lib$$SettingsController,$$MidiPlayer$es6lib$$MidiPlayer=function(_$$$$$$ControllerBase$es6lib$$default10){function $$MidiPlayer$es6lib$$MidiPlayer($scope,$timeout){_classCallCheck(this,$$MidiPlayer$es6lib$$MidiPlayer),_get(Object.getPrototypeOf($$MidiPlayer$es6lib$$MidiPlayer.prototype),"constructor",this).call(this,$scope),this.$timeout=$timeout,this.ready=!1,this.isPlaying=!1,this.isStopped=!0}return _inherits($$MidiPlayer$es6lib$$MidiPlayer,_$$$$$$ControllerBase$es6lib$$default10),_createClass($$MidiPlayer$es6lib$$MidiPlayer,[{key:"initAsync",value:function(tune){var _this38=this;return this.tune=tune,this._initPluginAsync().then(function(){return _this38._generateMidiAsync()}).then(function(){return _this38._loadMidiAsync()}).then(this.apply(function(){_this38.ready=!0,_this38.$timeout(function(){return $$utils$Utils$es6lib$$default.view.initTooltips()})}))}},{key:"_initPluginAsync",value:function(){return new Promise(function(resolve,reject){MIDI.loadPlugin({soundfontUrl:"../../../tunepal/lib/midi.js/soundfont/",instrument:"acoustic_grand_piano",onsuccess:resolve})})}},{key:"_generateMidiAsync",value:function(){var _this39=this;return new Promise(function(resolve,reject){var abcForPlayback=_this39.tune.abcForPlayback();_this39._midi=abc2midi(abcForPlayback);var b64encoded=btoa(String.fromCharCode.apply(null,_this39._midi));_this39._midiUrl="data:audio/midi;base64,"+b64encoded,resolve(_this39._midiUrl)})}},{key:"_loadMidiAsync",value:function(){var _this40=this;return new Promise(function(resolve,reject){var onsuccess=function(){resolve()},onprogress=function(stats,percent){percent*=100},onerror=function(e){};MIDI.Player.timeWarp=5/$$$$$$Config$es6lib$$default.playbackSpeed,MIDI.Player.loadFile(_this40._midiUrl,onsuccess,onprogress,onerror),MIDI.Player.setAnimation(function(data){var now=data.now<data.end?data.now:data.end,end=data.end;now===end&&_this40.$scope.$apply(function(){_this40.isPlaying=!1,_this40.isStopped=!0,MIDI.Player.stop()})})})}},{key:"togglePlaying",value:function(){this.isPlaying?this.pausePlaying():this.startPlaying()}},{key:"startPlaying",value:function(){this.isPlaying=!0,this.isStopped=!1,MIDI.Player.resume()}},{key:"pausePlaying",value:function(){this.isPlaying=!1,this.isStopped=!1,MIDI.Player.pause()}},{key:"stopPlaying",value:function(){this.isPlaying=!1,this.isStopped=!0,MIDI.Player.stop()}},{key:"download",value:function(){var blob=$$utils$Utils$es6lib$$default.blob.dataURLToBlob(this._midiUrl);saveAs(blob,this.tune.title+".midi")}}]),$$MidiPlayer$es6lib$$MidiPlayer}($$$$$$ControllerBase$es6lib$$default),$$MidiPlayer$es6lib$$default=$$MidiPlayer$es6lib$$MidiPlayer,$$pages$tune$TuneController$es6lib$$TuneController=function(_$$$$$$ControllerBase$es6lib$$default11){function $$pages$tune$TuneController$es6lib$$TuneController($scope,$rootScope,$routeParams,$http,$timeout,$sce,$localForage){var _this41=this;_classCallCheck(this,$$pages$tune$TuneController$es6lib$$TuneController),_get(Object.getPrototypeOf($$pages$tune$TuneController$es6lib$$TuneController.prototype),"constructor",this).call(this,$scope),this.$rootScope=$rootScope,this.$timeout=$timeout,this.$http=$http,this.$sce=$sce,this.config=$$$$$$Config$es6lib$$default,this.utils=$$utils$Utils$es6lib$$default,this.showTune=!1,this.showEuropeanaResults=!1,this.showEuropeanaLoading=!1,this.showEuropeanaNoResults=!1,this.isEditing=!1,this.midi=new $$MidiPlayer$es6lib$$default(this.$scope,this.$timeout),this.$scope.$watchCollection("midi",function(){}),this.tunepalIdEncoded=$routeParams.tunepalIdEncoded,this.tunepalId=decodeURIComponent(this.tunepalIdEncoded),$$utils$Utils$es6lib$$default.cache.tune.tunepalId===this.tunepalId?(this.tune=$$utils$Utils$es6lib$$default.cache.tune,this._initTune()):$$$$$$models$TunepalApi$es6lib$$default.fetchTuneAsync(this.$http,this.tunepalIdEncoded).then(function(tune){_this41.tune=tune,_this41._initTune()}),this._initUi(),$scope.$on("$routeChangeStart",function(){_this41.midi.stopPlaying(),$("#toast-container .toast").hide()})}return _inherits($$pages$tune$TuneController$es6lib$$TuneController,_$$$$$$ControllerBase$es6lib$$default11),_createClass($$pages$tune$TuneController$es6lib$$TuneController,[{key:"_initTune",value:function(){var _this42=this;$$utils$Utils$es6lib$$default.view.isLarge?Materialize.toast("Generating MIDI...",3e5):Materialize.toast("Generating MIDI... It might take a while on mobile.",3e5),this.midi.initAsync(this.tune).then(function(){return $("#toast-container .toast").hide()}),this._initUi(),this.$timeout(function(){return _this42._createAbcEditor()}),document.title=this.tune.title,this.showTune=!0,this.showEuropeanaLoading=!0,this.europeanaPortalUrl=$$$$$$models$EuropeanaApi$es6lib$$default.getPortalUrl(this.tune),$$$$$$models$EuropeanaApi$es6lib$$default.searchFetchAsync(this.$http,this.tune,this.$sce,1,5).then(function(results){return _this42._initEuropeanaResults(results)})}},{key:"_initEuropeanaResults",value:function(results){var _this43=this;results.items.length>0?(this.europeana=results,this.showEuropeanaResults=!0,this.showEuropeanaLoading=!1,this.$timeout(function(){return _this43.utils.view.initTooltips()})):(this.showEuropeanaLoading=!1,this.showEuropeanaNoResults=!0)}},{key:"_initUi",value:function(){var _this44=this;this.$timeout(function(){_this44.utils.view.initDropdown(),_this44.utils.view.initTooltips()}),$(window).resize(this.apply(function(){_this44._changeLayout(),_this44._resizeScore()})),this._changeLayout()}},{key:"_changeLayout",value:function(){this.isLandscape=$$utils$Utils$es6lib$$default.view.isLandscape}},{key:"_createAbcEditor",value:function(){var _this45=this;$("#abc").val(this.tune.notation),this.abcEditor=new ABCJS.Editor("abc",{paper_id:"score",onchange:function(){return _this45._resizeScore()}}),this._resizeScore()}},{key:"_resizeScore",value:function(){var cardContent=$(".score.card-content"),cardScore=$("#card-score"),score=$("#score"),windowHeight=($(window).width(),$(window).height()),scale=cardScore.width()/score.width();if(!this.isEditing||this.isLandscape)cardScore.css("transform","scale("+scale+")"),cardContent.height(cardScore.height()*scale);else{var halfHeight=$$utils$Utils$es6lib$$default.view.isMediumOrDown?windowHeight/2:(windowHeight-64)/2,cardContentHeight=cardScore.height()*scale;cardContentHeight>halfHeight&&(cardContentHeight=halfHeight,scale=cardContentHeight/score.height()),cardScore.css("transform","scale("+scale+")"),cardContent.height(cardContentHeight)}}},{key:"toggleEditing",value:function(){var _this46=this;this.isEditing=!this.isEditing,this.$timeout(function(){if(_this46._resizeScore(),_this46.isEditing){var scrollTop=$("#card-score").offset().top-$$utils$Utils$es6lib$$default.view.navbarHeight-5;$("html, body").animate({scrollTop:scrollTop},500)}})}},{key:"showSocialShare",value:function(){a2a.show_full()}},{key:"downloadAbc",value:function(){var blob=new Blob([this.tune.notation],{type:"text/vnd.abc"});saveAs(blob,this.tune.title+".abc")}}]),$$pages$tune$TuneController$es6lib$$TuneController}($$$$$$ControllerBase$es6lib$$default),$$pages$tune$TuneController$es6lib$$default=$$pages$tune$TuneController$es6lib$$TuneController,$$Routing$es6lib$$Routing=function $$Routing$es6lib$$Routing(app){_classCallCheck(this,$$Routing$es6lib$$Routing),app.controller("AboutController",$$pages$about$AboutController$es6lib$$default),app.controller("DiscographyController",$$pages$discography$DiscographyController$es6lib$$default),app.controller("EuropeanaController",$$pages$europeana$EuropeanaController$es6lib$$default),app.controller("HelpController",$$pages$help$HelpController$es6lib$$default),app.controller("IndexController",$$pages$index$IndexController$es6lib$$default),app.controller("KeywordSearchController",$$pages$keywordSearch$KeywordSearchController$es6lib$$default),app.controller("NotesSearchController",$$pages$notesSearch$NotesSearchController$es6lib$$default),app.controller("RandomTuneController",$$pages$randomTune$RandomTuneController$es6lib$$default),app.controller("RecordController",$$pages$record$RecordController$es6lib$$default),app.controller("SettingsController",$$pages$settings$SettingsController$es6lib$$default),app.controller("TuneController",$$pages$tune$TuneController$es6lib$$default),app.config(function($routeProvider,$locationProvider){$routeProvider.when("/about",{controller:"AboutController",controllerAs:"about",templateUrl:"scripts/pages/about/about.html"}).when("/discography/:keywordEncoded",{controller:"DiscographyController",controllerAs:"discography",templateUrl:"scripts/pages/discography/discography.html"}).when("/europeana/:tunepalIdEncoded",{controller:"EuropeanaController",controllerAs:"europeana",templateUrl:"scripts/pages/europeana/europeana.html"}).when("/help",{controller:"HelpController",controllerAs:"help",templateUrl:"scripts/pages/help/help.html"}).when("/keywordSearch/:keywordEncoded?/:selectedTunepalIdEncoded?",{controller:"KeywordSearchController",controllerAs:"keywordSearch",templateUrl:"scripts/pages/keywordSearch/keywordSearch.html"}).when("/notesSearch/:notes/:selectedTunepalIdEncoded?",{controller:"NotesSearchController",controllerAs:"notesSearch",templateUrl:"scripts/pages/notesSearch/notesSearch.html"}).when("/randomTune",{controller:"RandomTuneController",controllerAs:"randomTune",templateUrl:"scripts/pages/randomTune/randomTune.html"}).when("/record",{controller:"RecordController",controllerAs:"record",templateUrl:"scripts/pages/record/record.html"}).when("/settings",{controller:"SettingsController",controllerAs:"settings",templateUrl:"scripts/pages/settings/settings.html"}).when("/settings/:options*",{controller:"SettingsController",controllerAs:"settings",templateUrl:"scripts/pages/settings/settings.html"}).when("/tune/:tunepalIdEncoded",{controller:"TuneController",controllerAs:"tune",templateUrl:"scripts/pages/tune/tune.html"}).otherwise("/record"),$locationProvider.hashPrefix("!")})},$$Routing$es6lib$$default=$$Routing$es6lib$$Routing,$$utils$SearchParams$es6lib$$SearchParams=function(){function $$utils$SearchParams$es6lib$$SearchParams(){_classCallCheck(this,$$utils$SearchParams$es6lib$$SearchParams),this.params=[];var query=location.search.substring(1),fragments=query.split("&"),_iteratorNormalCompletion14=!0,_didIteratorError14=!1,_iteratorError14=void 0;try{for(var _step14,_iterator14=fragments[Symbol.iterator]();!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=!0){var fragment=_step14.value,pair=fragment.split("=");this.params[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}}catch(err){_didIteratorError14=!0,_iteratorError14=err}finally{try{!_iteratorNormalCompletion14&&_iterator14["return"]&&_iterator14["return"]()}finally{if(_didIteratorError14)throw _iteratorError14}}}return _createClass($$utils$SearchParams$es6lib$$SearchParams,[{key:"has",value:function(key){return"undefined"==typeof this.params[key]}},{key:"get",value:function(key){return this.params[key]}}]),$$utils$SearchParams$es6lib$$SearchParams}(),$$utils$SearchParams$es6lib$$default=$$utils$SearchParams$es6lib$$SearchParams,$$SeoController$es6lib$$SeoController=function(){function $$SeoController$es6lib$$SeoController(){_classCallCheck(this,$$SeoController$es6lib$$SeoController);var params=new $$utils$SearchParams$es6lib$$default;this._route=params.get("_escaped_fragment_")}return _createClass($$SeoController$es6lib$$SeoController,[{key:"navigate",value:function(){location.replace("/#!"+this._route)}},{key:"enabled",get:function(){return null!=this._route}}]),$$SeoController$es6lib$$SeoController}(),$$SeoController$es6lib$$default=$$SeoController$es6lib$$SeoController,app$scripts$App$es6$$seo=new $$SeoController$es6lib$$default;if(app$scripts$App$es6$$seo.enabled)app$scripts$App$es6$$seo.navigate();else{var app$scripts$App$es6$$app=angular.module("TunepalApp",["ngCookies","ngRoute","LocalForageModule"]);new $$Routing$es6lib$$default(app$scripts$App$es6$$app),new $$Directive$es6lib$$default(app$scripts$App$es6$$app)}$(function(){$(".button-collapse").sideNav(),$(".side-nav li a").on("click",function(e){$$utils$Utils$es6lib$$default.view.isMediumOrDown&&$(".button-collapse").sideNav("hide")}),$(".drag-target").remove()})}).call(void 0);